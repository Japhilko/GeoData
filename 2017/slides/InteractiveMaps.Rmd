---
title: "Interaktive Karten"
author: "Jan-Philipp Kolb"
date: "22 Februar 2017"
output: 
  slidy_presentation: 
    highlight: tango
    keep_md: yes
  ioslides_presentation: 
    keep_md: yes
  beamer_presentation: 
    colortheme: beaver
    fonttheme: structurebold
    highlight: tango
    theme: Warsaw
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,eval=F,message=F,warning=F)
library(knitr)
```


## Beispiel zu Campingplätzen

- Die Daten stammen von:

<http://www.openstreetmap.de/>

- Dabei wird die Overpass API genutzt:

<http://wiki.openstreetmap.org/wiki/Overpass_API>

```{r,echo=F,eval=T}
url <- "https://raw.githubusercontent.com/Japhilko/GeoData/master/2015/data/CampSites_Germany.csv"
```

```{r,eval=F}
url <- "https://raw.githubusercontent.com/Japhilko/
GeoData/master/2015/data/CampSites_Germany.csv"
```

```{r,eval=T}
CampSites <- read.csv(url)
```


## Überblick über Daten zu Campingplätzen

```{r,echo=F,eval=T}
kable(CampSites[1:8,1:4])
```


## Notwendige Pakete

[magrittr](https://cran.r-project.org/web/packages/magrittr/index.html) - für den Pipe Operator in R:

```{r,warning=F}
library("magrittr")
```


[leaflet](https://rstudio.github.io/leaflet/) - um  interaktive Karten mit der JavaScript Bibliothek 'Leaflet' zu erzeugen

```{r,warning=F}
library("leaflet")
```

## Eine erste interaktive Karte

```{r,eval=F}
leaflet()%>%
  addTiles()
```

![Hallo Leaflet](figure/FirstLeaflet.PNG)

## Auf eine Stadt zoomen

```{r,eval=F}
leaflet() %>%
  addTiles() %>%
  addMarkers(lng=8.456597, lat=49.48738,
             popup="Wo wir sind")
```

![](figure/leafletMZESMA.PNG)

## Eine interaktive Karte

```{r,eval=F}
m <- leaflet() %>%
  addTiles() %>%  
  addMarkers(lng=CampSites$lon, 
             lat=CampSites$lat, 
             popup=CampSites$name)
m
```

## [Stamen als Hintergrundkarte](https://rstudio.github.io/leaflet/basemaps.html)

```{r}
m %>% addProviderTiles("Stamen.Toner")
```

![Eine Stamen Karte als Hintergrund](figure/InteractiveStamen.PNG)

## CartoDB als Hintergrund

```{r}
m %>% addProviderTiles("CartoDB.Positron")
```

![CartoDB als Hintergrund](figure/CartoDBInteractive.PNG)

- [CartoDB](https://carto.com/attribution)

- [Info zu Map Tiles](https://www.mapbox.com/help/how-web-maps-work/)


## [Mehr Hintergründe](http://leaflet-extras.github.io/leaflet-providers/preview/index.html)


```{r}
m %>% addProviderTiles("NASAGIBS.ViirsEarthAtNight2012")
```

![Lichter der Nacht](figure/LightsInteractive.PNG)




## Mehr Informationen hinzufügen

```{r,eval=F}
popupInfo <- paste(CampSites$name,"\n",CampSites$website)
```

```{r,eval=F}
m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=CampSites$lon, 
             lat=CampSites$lat, 
             popup=popupInfo)
m
```

Das Ergebnis ist hier:

<http://rpubs.com/Japhilko82/CampSitesHL>

## Die resultierende Karte

![Campingplätze in Deutschland](figure/Germany_Campsites.PNG)

## Popups in einer interactiven Karte

![Camping Mannheim](figure/Camping_Mannheim.PNG)

Ich hab die Ergebnisse hochgeladen:

<http://rpubs.com/Japhilko82/Campsites>

## Wie man auf Rpubs publizieren kann

![Publizieren auf Rpubs](figure/PublishCampSitesGermany.PNG)


## Ein weiteres Beispiel - Weltkulturerbe

```{r,cache=T}
url <- "https://raw.githubusercontent.com/Japhilko/
GeoData/master/2015/data/whcSites.csv"

whcSites <- read.csv(url) 
```




## Eine interaktive Karte erstellen

```{r}
m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=whcSites$lon, 
             lat=whcSites$lat, 
             popup=whcSites$name_en)
m
```

## Die Karte zeigen

![Weltkulturerbestätten](figure/WHCPopUps.PNG) 

## Farbe hinzu

```{r}
whcSites$color <- "red"
whcSites$color[whcSites$category=="Cultural"] <- "blue"
whcSites$color[whcSites$category=="Mixed"] <- "orange"
```

## Eine Karte mit Farbe erzeugen

```{r}
m1 <- leaflet() %>%
  addTiles() %>%  
  addCircles(lng=whcSites$lon, 
             lat=whcSites$lat, 
             popup=whcSites$name_en,
             color=whcSites$color)
m1
```

## Die Karte zeigen

![Karte Weltkulturerbe](figure/WHCcircles.PNG) 

## [Die Karte abspeichern](http://www.r-bloggers.com/interactive-mapping-with-leaflet-in-r-2/)

![Als Website speichern](figure/snapshot2.png)


## Links und Quellen

- [Rbloggers Artikel zu Leaflet](http://www.r-bloggers.com/the-leaflet-package-for-online-mapping-in-r/)

- [Einführung in Leaflet für R](https://rstudio.github.io/leaflet/)

- [Offline Karten mit RgoogleMaps und leaflet](https://blog.hwr-berlin.de/codeandstats/category/scientific-software/r/)
