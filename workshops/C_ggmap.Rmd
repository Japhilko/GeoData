---
title: "ggmap"
author: "Jan-Philipp Kolb"
date: "13 April 2015"
output: ioslides_presentation
---

```{r,echo=F}
Ex <- T
Ca <- T
library(knitr)
```



## Library ggmap

```{r,message=F}
library(ggmap)
```

```{r,message=F,eval=Ex,cache=Ca}
qmap("Mannheim")
MA_map <- qmap("Mannheim",zoom=14)
```

## Other zoom level

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 12)
```

## Get closer

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 13)
```


## Get very close

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 20)
```

## ggmap - source

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 14, source="osm")
```


## ggmap - maptype

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 14, maptype="satellite")
```

## ggmap - maptype

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 14, maptype="hybrid")
```


## ggmap - maptype

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 14,
 maptype="toner",source="stamen")
```

## Other ways to get a map

- qmap is a wrapper for ggmap and get_map
- with get_googlemap you get similar results

```{r,message=F,eval=Ex,cache=Ca}
MAmap <- get_googlemap("Mannheim")
ggmap(MAmap)
```


## Geocoding

> Geocoding (...) uses a description of a location, most typically a postal address or place name, to find geographic coordinates from spatial reference data ... 

[Wikipedia - Geocoding](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#blockquotes)

```{r,message=F,eval=F}
geocode("Mannheim University")
```

```{r,echo=F,message=F,cache=Ca}
MAgc <- geocode("Mannheim University")
kable(MAgc)
```

## Geocoding - points of interest

```{r,eval=F}
POI1 <- geocode("B2, 1 Mannheim")
POI2 <- geocode("Hbf Mannheim")
POI3 <- geocode("Wasserturm Mannheim")
```


## Geocoding - with a loop

```{r,message=F,eval=Ex,cache=Ca}
POI <- c("B2, 1 Mannheim","Hbf Mannheim",
         "Wasserturm Mannheim")

ListPOI <- data.frame(lat=NA,lon=NA)

for ( i in 1:length(POI)){
  geoPOI <- geocode(POI[i])
  ListPOI[i,"lat"] <-  geoPOI$lat 
  ListPOI[i,"lon"] <-  geoPOI$lon 
}
```

## Points in map

[Article by David Kahle and Hadley Wickham](http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf) on the usage of ggmap.


```{r,message=F,warning=F,eval=Ex,cache=Ca}
MA_map +
geom_point(aes(x = lon, y = lat),
data = ListPOI)
```

## More about adding points

- Usage of [geom_point](http://zevross.com/blog/2014/07/16/mapping-in-r-using-the-ggplot2-package/)
- Question on [stackoverflow](http://stackoverflow.com/questions/15069963/getting-a-map-with-points-using-ggmap-and-ggplot2)


## ggmap - adding colors

```{r,eval=Ex,cache=Ca}
ListPOI$color <- c("A","B","C")
MA_map +
geom_point(aes(x = lon, y = lat,col=color),
data = ListPOI)
```

## ggmap - bigger dots

```{r,eval=Ex,cache=Ca}
ListPOI$size <- c(10,20,30)
MA_map +
geom_point(aes(x = lon, y = lat,col=color,size=size),
data = ListPOI)
```



```{r,eval=F,echo=F}
#library(devtools)
#devtools::install_github("Japhilko/GeoData/geosmdata2")
library(geosmdata2)
```

## Cheatsheet

- Cheatsheet on [data visualisation](https://www.rstudio.com/wp-content/uploads/2015/04/ggplot2-cheatsheet.pdf)

![pic](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.png)


## Get the distance between 2 points

```{r,message=F,eval=Ex,cache=Ca}
mapdist("Q1, 4 Mannheim","B2, 1 Mannheim")
```

```{r,message=F,eval=Ex,cache=Ca}
mapdist("Q1, 4 Mannheim","B2, 1 Mannheim",mode="walking")
```

## Get another distance

```{r,message=F,eval=Ex,cache=Ca}
mapdist("Q1, 4 Mannheim","B2, 1 Mannheim",mode="bicycling")
```

## Contourplot - preparing the data

```{r,cache=T,message=F,warning=F,message=F,results='hide'}
library(geosmdata2)
xml_obj <- get_osm_nodes("bakery","Berlin")
info <- extract_info_op(xml_obj,"bakery")
```

## Contourplot - get the map

```{r,cache=T,message=F}
library(ggmap)
Imap <- qmap(location = "Berlin", zoom = 10, maptype="toner",source="stamen")
Imap
```

## Make first contourplot

The example is taken from [here](http://www.r-bloggers.com/contour-and-density-layers-with-ggmap/)

```{r}
Imap + geom_density2d(data = info, aes(x = lon, y = lat),lwd=1.5)
```


## [Visualize with hexbins](http://rud.is/b/2015/05/15/u-s-drought-monitoring-with-hexbin-state-maps-in-r/)

![pic](https://rud.is/b/wp-content/uploads/2015/05/201505151.png)

## [Another ggmap example](http://blog.corynissen.com/2015/05/creating-styled-google-maps-in-ggmap.html)

![pic2](http://i.imgur.com/WJEyxMC.jpg)

