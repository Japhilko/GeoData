---
title: "ggmap"
author: "Jan-Philipp Kolb"
date: "04/13/2015"
output: beamer_presentation
---

```{r,echo=F,warning=F}
Ex <- T
Ca <- T
library(knitr)

graph.path <- "../data/figure/"
```


## Outline

- Map types
- The package [ggmap](http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf)
  - Road maps with `ggmap`
  - Satellite maps with `ggmap`


## Road maps

A road map is one of the most widely used map types. 

- These maps show major and minor highways and roads (depending on
detail) 

- as well as things like airports, city locations and points of
interest like parks, campgrounds and monuments. 

- Major highways on a road map are generally red and larger than other roads, 

- while minor roads are a lighter color and a narrower line.

## Road maps

```{r,echo=F,warning=F,message=F}
if(internet){
library(leaflet)
library(magrittr)
m <- leaflet() %>% setView(lng = 8.47955, lat = 49.49671, zoom = 12)
m %>% addTiles()   
}else{
  paste(graph.path,"RoadMap.PNG",sep="")
}

```


## Install the library

- We'll need package ggmap 

```{r,eval=F}
install.packages("ggmap")
```

```{r,echo=F}
link1 <- paste(graph.path,"Installpackages1.PNG",sep="")
```
![pic](`r link1 `)

```{r,echo=F}
link1 <- paste(graph.path,"Installpackages2.PNG",sep="")
```
![pic](`r link1 `)


## Library ggmap

- To load the lbrary we use the command `library`

```{r,message=F,warning=F}
library(ggmap)
```

```{r,message=F,eval=Ex,cache=Ca}
qmap("Mannheim")
MA_map <- qmap("Mannheim")
```

- We load a library with `library()`

## Map for other place

```{r,message=F}
qmap("Berlin Brandenburger Tor")
```

## Map for other place

- We need another zoom level

```{r,message=F}
qmap("Germany")
```

## Get help

```{r,eval=F}
?qmap
```


```{r,echo=F}
link1 <- paste(graph.path,"qmapExample.PNG",sep="")
```
![pic](`r link1 `)

```



## Other zoom level

```{r,message=F,eval=Ex,cache=Ca}
qmap("Mannheim", zoom = 12)
```

## Get closer

```{r,message=F,eval=Ex,cache=Ca}
qmap(location = 'Mannheim', zoom = 13)
```


## Get very close

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 20)
```

## ggmap - source

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14, source="osm")
```


## ggmap - maptype

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14, maptype="satellite")
```

## ggmap - maptype

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14, maptype="hybrid")
```


## ggmap - maptype

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14,
 maptype="toner",source="stamen")
```


## ggmap - maptype watercolor

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14,
 maptype="watercolor",source="stamen")
```

## ggmap - maptype toner-lite

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14,
 maptype="toner-lite",source="stamen")
```

## ggmap - maptype toner-hybrid

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14,
 maptype="toner-hybrid",source="stamen")
```

## ggmap - maptype terrain-lines

```{r,message=F,eval=Ex,cache=Ca}
qmap('Mannheim', zoom = 14,
 maptype="terrain-lines",source="stamen")
```


## ggmap - create an object 

```{r,warning=F,message=F,cache=T}
MA_map <- qmap('Mannheim', 
               zoom = 14,
               maptype="toner",
               source="stamen")
```


## Save graphics

```{r,echo=F}
link1 <- paste(graph.path,"RstudioExport.PNG",sep="")
```

![pic](`r link1 `)


## Geocoding

> Geocoding (...) uses a description of a location, most typically a postal address or place name, to find geographic coordinates from spatial reference data ... 

[Wikipedia - Geocoding](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#blockquotes)

```{r,message=F,eval=F,warning=F}
geocode("Mannheim Wasserturm",source="google")
```

```{r,echo=F,message=F,cache=Ca}
MAgc <- geocode("Mannheim University",source="google")
kable(MAgc)
```


## Reverse geocoding

> Reverse geocoding is the process of back (reverse) coding of a point location (latitude, longitude) to a readable address or place name. This permits the identification of nearby street addresses, places, and/or areal subdivisions such as neighbourhoods, county, state, or country.

Source: [Wikipedia](https://en.wikipedia.org/wiki/Reverse_geocoding)

```{r,cache=T}
revgeocode(c(48,8))
```



## Get the distance between 2 points

```{r,message=F,eval=Ex,cache=Ca}
mapdist("Q1, 4 Mannheim","B2, 1 Mannheim")
```

```{r,message=F,eval=Ex,cache=Ca}
mapdist("Q1, 4 Mannheim","B2, 1 Mannheim",mode="walking")
```


## Get another distance

```{r,message=F,eval=Ex,cache=Ca}
mapdist("Q1, 4 Mannheim","B2, 1 Mannheim",mode="bicycling")
```

## Geocoding - points of interest

```{r,cache=Ca,message=F,warning=F}
POI1 <- geocode("B2, 1 Mannheim",source="google")
POI2 <- geocode("Hbf Mannheim",source="google")
POI3 <- geocode("Wasserturm Mannheim",source="google")
ListPOI <-rbind(POI1,POI2,POI3)
POI1;POI2;POI3
```


## Points in map

```{r,message=F,warning=F,eval=Ex,cache=Ca}
MA_map +
geom_point(aes(x = lon, y = lat),
data = ListPOI)
```

## Points in map

```{r,message=F,warning=F,eval=Ex,cache=Ca}
MA_map +
geom_point(aes(x = lon, y = lat),col="red",
data = ListPOI)
```


## ggmap - adding different colors

```{r,eval=Ex,cache=Ca}
ListPOI$color <- c("A","B","C")
MA_map +
geom_point(aes(x = lon, y = lat,col=color),
data = ListPOI)
```

## ggmap - bigger dots

```{r,eval=Ex,cache=Ca}
ListPOI$size <- c(10,20,30)
MA_map +
geom_point(aes(x = lon, y = lat,col=color,size=size),
data = ListPOI)
```


## Get a route from Google maps

```{r,message=F,warning=F,cache=T}
from <- "Mannheim Hbf"
to <- "Mannheim B2 , 1"
route_df <- route(from, to, structure = "route")
```

[More information](http://rpackages.ianhowson.com/cran/ggmap/man/route.html)

## Draw a map with this information

```{r,message=F,warning=F,cache=T}
qmap("Mannheim Hbf", zoom = 14) +
  geom_path(
    aes(x = lon, y = lat),  colour = "red", size = 1.5,
    data = route_df, lineend = "round"
  )
```



## Resources

- [Article by David Kahle and Hadley Wickham](http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf) on the usage of ggmap.
- [Grab a map](http://rpackages.ianhowson.com/cran/ggmap/man/get_map.html)

More about adding points

- Usage of [geom_point](http://zevross.com/blog/2014/07/16/mapping-in-r-using-the-ggplot2-package/)
- Question on [stackoverflow](http://stackoverflow.com/questions/15069963/getting-a-map-with-points-using-ggmap-and-ggplot2)

![pic](http://i.stack.imgur.com/q3euq.png)

## Cheatsheet

- Cheatsheet on [data visualisation](https://www.rstudio.com/wp-content/uploads/2015/04/ggplot2-cheatsheet.pdf)

![pic](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.png)


## Resources and literature

[ggmap: Spatial Visualization with ggplot2](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.375.8693&rep=rep1&type=pdf)

by David Kahle and Hadley Wickham
 