bb_SK <- create_bbox(loc1,bv)
overpass_info <- xmlParse(paste("http://www.overpass-api.de/api/xapi?way[bbox=",bb_SK,"][",object_x,"]",
sep="")
)
overpass_info
date()
data.path <- "D:/Daten/Daten/GeoDaten/XAPI"
graph.path <- "J:/Work/Statistik/Kolb/VortrÃ¤ge/20150617_Forschungsboerse/Folien/figure"
rcode.path <- "J:/Work/Statistik/Kolb/Paper/UseOSMdata/rcode"
setwd(rcode.path)
getDat_overpass <- function(object_x,loc1,bv){
bb_SK <- create_bbox(loc1,bv)
return(xmlParse(paste("http://www.overpass-api.de/api/xapi?way[bbox=",bb_SK,"][",object_x,"]",
sep="")))
}
x_overpass <- getDat_overpass(object_x="leisure=garden",loc1="Mannheim",bv=0.1)
x_overpass
x_root = xmlRoot(x_overpass)
x_root
getNodeSet(schools_speyer,"//tag")
getNodeSet(x_root,"//tag")
x_childs <- xmlChildren(x_root)
x_childs
getNodeSet(x_root,"//way")
getNodeSet(x_root,"/way/way")
getNodeSet(x_root,"//way")
info5 <- getNodeSet(x_root,"//way")
Nodes <- getNodeSet(x_root,"//way")
Nodes[[1]]
?agrep
agrep("id",Nodes[[1]])
Nodes[[1]]
str(Nodes[[1]])
getNodeSet(Nodes[[1]],"//id")
getNodeSet(Nodes[[1]],"id")
xmlAttrs(Nodes[[1]])
xmlAttrs(Nodes)
xmlAttrs(Nodes[[i]])
for (i in 1:length(Nodes)){
xmlAttrs(Nodes[[i]])
}
length(Nodes)
x_df <- data.frame(id=rep(NA,length(Nodes)))
for (i in 1:length(Nodes)){
xmlAttrs(Nodes[[i]])
}
for (i in 1:length(Nodes)){
x_df$id[i] <- xmlAttrs(Nodes[[i]])
}
x_df
x_root
x_root[[1]]
x_root[[2]]
x_root[[3]]
Nodes <- getNodeSet(x_root,"//node")
Nodes
xmlAttrs(Nodes[[i]])
str(xmlAttrs(Nodes[[i]]))
x_df2 <- data.frame(id=rep(NA,length(Nodes)),lat=rep(NA,length(Nodes)),lon=rep(NA,length(Nodes)))
x_df2[i,]<-  xmlAttrs(Nodes[[i]])
x_df2 <- data.frame(id=rep(NA,length(Nodes)),lat=rep(NA,length(Nodes)),lon=rep(NA,length(Nodes)))
for (i in 1:length(Nodes)){
x_df2[i,]<-  xmlAttrs(Nodes[[i]])
}
x_df2
nrow(x_df2)
MAmap <- qmap("Mannheim",zoom=10)
MAmap
MAmap +
geom_point(aes(x = lon, y = lat),
data = x_df2)
x_df2$lat <- as.numeric(x_df2$lat)
x_df2$lon <- as.numeric(x_df2$lon)
MAmap +
geom_point(aes(x = lon, y = lat),
data = x_df2)
MAmap <- qmap("Mannheim",zoom=14)
MAmap +
geom_point(aes(x = lon, y = lat),
data = x_df2)
data.path2 <- "D:/Daten/Daten/GeoDaten"
library(rgdal)
setwd(data.path2)
PLZ <- readOGR ("post_pl.shp","post_pl")
MA <- PLZ[PLZ@data$PLZORT99=="Mannheim",]
bMA <- bbox(MA)
bMA
geocode(Mannheim)
geocode("Mannheim")
bbox_x <- paste(bMA["x","min"],bMA["y","min"],bMA["x","max"],bMA["y","max"],sep=",")
schools_MA <- xmlParse(paste("http://www.overpass-api.de/api/xapi?way[bbox=",bbox_x,"][",object_x,"]",
sep=""))
schools_MA
object_x="amenity=school"
schools_MA <- xmlParse(paste("http://www.overpass-api.de/api/xapi?way[bbox=",bbox_x,"][",object_x,"]",
sep=""))
schools_MA
#### Spielpl?tze
readOSMCoordValue <- function( value, OSM.Data )
{
dataStorage <- matrix( NA, ncol = 2, nrow = 1 )
# Way-nodes
data_way <- NULL
way_id  <- unlist( xpathApply( OSM.Data, paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" ) ) )
if( length( way_id ) > 0 )
{
for(i in 1:length( way_id ) )
{
p.node    <- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
ifelse( length( way_node_save ) == 0, way_node 	<- NA, way_node <- way_node_save )
# Datensatz zusammenf?gen
data_way[[ i ]]	<- way_node
}
dataStorage <- matrix( NA, ncol = 2, nrow = length( data_way ) )
# Koordinaten
for(i in 1:length( data_way ) )
{
nodes	<- data_way[[ i ]]
p.lat	<- paste("//node[@id = ", nodes  ,"]/@ lat", sep = "")
p.lon	<- paste("//node[@id = ", nodes  ,"]/@ lon", sep = "")
lat <- lon <- NULL
for( j in 1:length(nodes ) )
{
lat[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lon[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
}
dataStorage[ i, ] <- c( mean( lon ), mean( lat ) )
}
}
node_lat <- as.numeric( unlist( xpathApply( OSM.Data, paste( "//tag[@v = '", value, "']/parent::node/@ lat", sep = "" ) ) ) )
node_lon <- as.numeric( unlist( xpathApply( OSM.Data, paste( "//tag[@v = '", value, "']/parent::node/@ lon", sep = "" ) ) ) )
if( length( node_lat ) > 0 ) dataStorage <- rbind( dataStorage, cbind( lon = node_lon, lat = node_lat ) )
rownames( dataStorage ) <- NULL
colnames( dataStorage ) <- c( "lon", "lat" )
if( all( is.na( dataStorage ) ) )
{
cat( "no matches" )
}else{ return <- na.omit( dataStorage ); return }
}
school_FF <- readOSMCoordValue( "school", schools_MA )
school_FF
MAmap <- qmap("Mannheim",zoom=13)
MAmap +
geom_point(aes(x = lon, y = lat),
data = school_FF)
school_FF <- data.frame(school_FF)
MAmap +
geom_point(aes(x = lon, y = lat),
data = school_FF)
xpathApply(x_overpass , paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" )
)
x_object="school" # value
xpathApply(x_overpass , paste( "//tag[@v = '", x_object, "']/parent::way/@ id", sep = "" ))
paste( "//tag[@v = '", x_object, "']/parent::way/@ id", sep = "" )
x_overpass <- schools_MA
xpathApply(x_overpass , paste( "//tag[@v = '", x_object, "']/parent::way/@ id", sep = "" ))
x_overpass
xpathApply(x_overpass , paste( "//tag[@v = '", x_object, "']/parent::way/@ id", sep = "" ))
x_overpass
xpathApply(x_overpass , paste( "//tag[@v = '", x_object, "']/tag/@ k", sep = "" ))
xpathApply(x_overpass , paste( "//tag[@v = '", x_object, "']tag/@ k", sep = "" ))
paste( "//tag[@v = '", x_object, "']/parent::way/@ id", sep = "" )
xpathApply(x_overpass ,"//tag[@v = 'school']/parent::way/@ id")
xpathApply(x_overpass ,"//tag[@v]")
xpathApply(x_overpass ,"//tag[@v= 'school']")
value="school"
OSM.Data=schools_MA
dataStorage <- matrix( NA, ncol = 2, nrow = 1 )
# Way-nodes
data_way <- NULL
way_id  <- unlist( xpathApply( OSM.Data, paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" ) ) )
way_id
i<-1
p.node    <- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
p.node
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
ifelse( length( way_node_save ) == 0, way_node 	<- NA, way_node <- way_node_save )
data_way[[ i ]]	<- way_node
for(i in 1:length( way_id ) )
{
p.node    <- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
ifelse( length( way_node_save ) == 0, way_node 	<- NA, way_node <- way_node_save )
# Datensatz zusammenf?gen
data_way[[ i ]]	<- way_node
}
dataStorage <- matrix( NA, ncol = 2, nrow = length( data_way ) )
i<-1
nodes	<- data_way[[ i ]]
p.lat	<- paste("//node[@id = ", nodes  ,"]/@ lat", sep = "")
p.lon	<- paste("//node[@id = ", nodes  ,"]/@ lon", sep = "")
nodes
data_way[[ i ]]
data_way
nodes	<- data_way[[ i ]]
p.lat	<- paste("//node[@id = ", nodes  ,"]/@ lat", sep = "")
p.lon	<- paste("//node[@id = ", nodes  ,"]/@ lon", sep = "")
p.lat
j<-1
lat[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lat <- lon <- NULL
lat[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lon[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
lat
OSM.Data
paste("//node[@id = ", nodes  ,"]/@ lat", sep = "")
xpathApply( OSM.Data, //node[@id = 267966470]/@ lat )
xpathApply( OSM.Data, "//node[@id = 267966470]/@ lat" )
getNodeSet(schools_speyer,"//way")
getNodeSet(schools_speyer,"//node")
getNodeSet(schools_speyer,"//way")
xpathApply( OSM.Data, "//node[@id = 267966470]/@ k" )
xpathApply( OSM.Data, "//node[@id = 267966470]/@ v" )
xpathApply( OSM.Data, "//node[@id = 267966470]" )
xpathApply( OSM.Data, "//way[@id = 267966470]" )
xpathApply( OSM.Data, "//way[@id = 203829903]" )
paste("//node[@id = ", nodes  ,"]/@ lat", sep = "")
xpathApply( OSM.Data, "//node[@id = 267966470]/@ lat" )
xpathApply( OSM.Data, "//node[@id = 267966470]" )
xpathApply( OSM.Data, "//way[@id = 267966470]" )
xpathApply( OSM.Data, "//way" )
xpathApply( OSM.Data, "//way[@id = 349804788]" )
xpathApply( OSM.Data, "//way[@id = 349804788]@tag" )
xpathApply( OSM.Data, "//way[@id = 349804788]@ tag" )
xpathApply( OSM.Data, "//way[@id = 349804788]//tag" )
xpathApply( OSM.Data, "//way//tag" )
bMA
geocode("Ludwigshafen")
plot(MA)
abline(v="49.410141")
abline(v="8.417813")
abline(h="49.410141")
abline(h="49.58984")
abline(v="8.59396")
school_FF <- readOSMCoordValue( "school", schools_MA )
xpathApply( OSM.Data, "//way//tag" )
length(OSM.Data)
xmlSize(OSM.Data)
xpathApply( OSM.Data, "way" )
xpathApply( OSM.Data, "//way" )
n_obj <- length(xpathApply( OSM.Data, "//way" ))
n_obj <- length(xpathApply( OSM.Data, "//way" ))
xpathApply( OSM.Data, "//way[@id = 349804788]//way" )
xpathApply( OSM.Data, "id" )
xpathApply( OSM.Data, "//way//id" )
xpathApply( OSM.Data, "way//id" )
xmlAttrs(OSM.Data)
Nodes <- getNodeSet(OSM.Data,"//node")
Nodes
Nodes <- getNodeSet(OSM.Data,"//way")
Nodes
way_id  <- unlist( xpathApply( OSM.Data, paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" ) ) )
way_id
p.node		<- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
way_node_save
paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, "//way[@id = '24652742']" ) )
way_node_save	<- as.numeric( xpathApply( OSM.Data, "//way[@id = '24652742']/nd/" ) )
way_id  <- unlist( xpathApply( OSM.Data, paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" ) ) )
xpathApply( OSM.Data, "//way[@id = 349804788]//tag" )
Liste <- list()
for (i in 1:n_obj){
Liste[[i]] <-   xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag",sep="") )
}
Liste
Liste[[i]] <-   xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag//k",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag//k",sep="") )
Liste[[i]] <-   xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/k",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/k",sep="") )
Liste[[i]] <-   xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag@ k",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag",sep="") )
info5 <- xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag",sep="") )
str(info5)
xmlValue(info5)
unlist(xpathApply(OSM.Data, "//*", xmlName))
unlist(xpathApply(OSM.Data, "//id", xmlName))
unlist(xpathApply(OSM.Data, "//*", xmlAttrs))
?xpathApply
setwd(data.path)
saveXML(schools_MA,"schools_MA.xml")
dir()
OSM.Data
xpathApply( OSM.Data,"//way")
info <- xpathApply( OSM.Data,"//way")
info2 <- xpathApply( info,"//nd")
info2 <- xpathApply( info[[1]],"//nd")
info2
info <- xpathApply( OSM.Data,"//way//nd")
info
info <- xpathApply( OSM.Data,"//way//tag")
info
info <- xpathApply( OSM.Data,"//way//tag/parent")
info
info <- xpathApply( OSM.Data,"//way//tag/parent::way")
info
school_FF
info <- xpathApply( OSM.Data,"//way//tag/parent::way")
xpathApply( OSM.Data,"//way//tag/parent::way")
geocode("Max-Hachenburg-Schule")
tail(school_FF)
school_FF - 49.48222
school_FF$lat - 49.48222
school_FF[,2] - 49.48222
dist(school_FF[,2],49.48222)
abs(school_FF[,2],49.48222)
abs(school_FF[,2]-49.48222)
which.min(abs(school_FF[,2]-49.48222))
geocode("Max-Hachenburg-Schule")
which.min(abs(school_FF[,2]-49.48222)+abs(school_FF[,1]-8.474271))
paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" )
paste( "//tag[@v = '", value, "']/parent::way/@ id", sep = "" )
xpathApply( OSM.Data, "//tag[@v = 'school']/parent::way/@ id" )
xpathApply( OSM.Data, "//tag[@v = 'school']" )
xpathApply( OSM.Data, "//tag[@v = 'school']/parent" )
xpathApply( OSM.Data, "//tag[@v = 'school']/." )
xpathApply( OSM.Data, "//tag[@v = 'school']/" )
xpathApply( OSM.Data, "//tag[@v = 'school']/." )
xpathApply( OSM.Data, "//tag[@v = 'school']/.." )
xpathApply( OSM.Data, "//tag[@v = 'name']" )
xpathApply( OSM.Data, "//tag[@k = 'name']" )
xpathApply( OSM.Data, "//tag[@k = 'name']/parent::way/@ id" )
xpathApply( OSM.Data, "//tag[@k = 'name']" )
xpathApply( OSM.Data, "//tag[@k = 'name']/preceding-sibling" )
xpathApply( OSM.Data,"attribute::*")
xpathApply( OSM.Data,"//tag/attribute::*")
xpathApply( OSM.Data[[1]],"//tag/attribute::*")
xpathApply( OSM.Data,"//tag/attribute::*")
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/child::text()",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/child::node()",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/node()",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag::node()",sep="") )
xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/child::*",sep="") )
unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
Liste <- list()
Liste <- list()
for (i in 1:length(way_id)){
Liste[[i]] <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
}
Liste
unlist(Liste)
Liste
lapply(Liste,length)
unlist(lapply(Liste,length))
way_id
ids <- rep(way_id,unlist(lapply(Liste,length)))
cbind(unlist(Liste),ids)
Liste[[i]]
Liste[[i]]$k
Liste[["k"]]
which(names(Liste_i)==k)
which(names(Liste_i)=="k")
Liste_i <-   xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag",sep="") )
which(names(Liste_i)=="k")
names(Liste_i)
Liste_i
Liste_i <-   unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag",sep="") ) )
Liste_i
Liste <- list()
for (i in 1:n_obj){
Liste[[i]] <-   xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag",sep="") )
}
Liste[[i]]
unlist(Liste)
cbind(unlist(Liste),ids)
Liste <- list()
for (i in 1:length(way_id)){
Liste[[i]] <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
}
ids <- rep(way_id,unlist(lapply(Liste,length)))
cbind(unlist(Liste),ids)
nlist(Liste)
unlist(Liste)
Liste[[i]]
Liste_i <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
which(names(Liste_i)=="k")
ind_k <- which(names(Liste_i)=="k")
ind_v <- which(names(Liste_i)=="v")
ind_v
cbind(Liste_i[ind_k],Liste_i[ind_v])
data.frame(Liste_i[ind_k],Liste_i[ind_v],way_id[i])
data.frame(k=Liste_i[ind_k],v=Liste_i[ind_v],id=way_id[i])
data.frame(k=Liste_i[ind_k],v=Liste_i[ind_v],id=rep(way_id[i],length(ind_k))
)
Liste <- list()
for (i in 1:n_obj){
Liste_i <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
ind_k <- which(names(Liste_i)=="k")
ind_v <- which(names(Liste_i)=="v")
Liste[[i]] <- data.frame(k=Liste_i[ind_k],v=Liste_i[ind_v],id=rep(way_id[i],length(ind_k)))
}
DF_schools <- unlist(Liste)
unlist(Liste)
DF_schools <- do.call(Liste,rbind)
DF_schools <- do.call(rbind,Liste)
DF_schools
head(DF_schools)
p.node		<- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
ay_node_save
way_node_save
p.lat	<- paste("//node[@id = ", way_node_save  ,"]/@ lat", sep = "")
p.lat
p.lon	<- paste("//node[@id = ", way_node_save  ,"]/@ lon", sep = "")
lon_i <- mean( lon )
lat_i <-  mean( lat ) )
Liste[[i]] <- data.frame(k=Liste_i[ind_k],
v=Liste_i[ind_v],
id=rep(way_id[i],length(ind_k)),
lat=rep(lat_i,length(ind_k)),
lon=rep(lon_i,length(ind_k))
)
lat_i <-  mean( lat )
lon_i <- mean( lon )
lon_i <- mean( lon ,na.rm=T)
lat_i <-  mean( lat,na.rm=T )
ind_k <- which(names(Liste_i)=="k")
ind_v <- which(names(Liste_i)=="v")
Liste[[i]] <- data.frame(k=Liste_i[ind_k],
v=Liste_i[ind_v],
id=rep(way_id[i],length(ind_k)),
lat=rep(lat_i,length(ind_k)),
lon=rep(lon_i,length(ind_k))
)
Liste[[i]]
Liste <- list()
for (i in 1:n_obj){
Liste_i <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
p.node		<- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
p.lat	<- paste("//node[@id = ", way_node_save  ,"]/@ lat", sep = "")
p.lon	<- paste("//node[@id = ", way_node_save  ,"]/@ lon", sep = "")
lat <- lon <- NULL
for( j in 1:length(nodes ) )
{
lat[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lon[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
}
lon_i <- mean( lon ,na.rm=T)
lat_i <-  mean( lat,na.rm=T )
ind_k <- which(names(Liste_i)=="k")
ind_v <- which(names(Liste_i)=="v")
Liste[[i]] <- data.frame(k=Liste_i[ind_k],
v=Liste_i[ind_v],
id=rep(way_id[i],length(ind_k)),
lat=rep(lat_i,length(ind_k)),
lon=rep(lon_i,length(ind_k))
)
}
DF_schools <- do.call(rbind,Liste)
i
Liste_i <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
Liste_i
p.node		<- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
p.node
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
p.lat	<- paste("//node[@id = ", way_node_save  ,"]/@ lat", sep = "")
p.lon	<- paste("//node[@id = ", way_node_save  ,"]/@ lon", sep = "")
lat <- lon <- NULL
for( j in 1:length(nodes ) )
{
lat[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lon[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
}
as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
j
lat
lat <- lon <- rep(NA,length(nodes ))
for( j in 1:length(nodes ) )
{
lat[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lon[ j ] 	<- as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
}
as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
lat[ j ] <- ifelse(length(lat_j)>0,lat_j,NA)
lat_j 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lat[ j ] <- ifelse(length(lat_j)>0,lat_j,NA)
Liste <- list()
for (i in 1:n_obj){
Liste_i <- unlist(xpathApply( OSM.Data, paste("//way[@id = ",way_id[i],"]//tag/attribute::*",sep="") ) )
p.node		<- paste( "//way[@id = '", way_id[i] ,"']/nd/@ref", sep = "" )
way_node_save	<- as.numeric( xpathApply( OSM.Data, p.node ) )
p.lat	<- paste("//node[@id = ", way_node_save  ,"]/@ lat", sep = "")
p.lon	<- paste("//node[@id = ", way_node_save  ,"]/@ lon", sep = "")
lat <- lon <- rep(NA,length(nodes ))
for( j in 1:length(nodes ) )
{
lat_j 	<- as.numeric( xpathApply( OSM.Data, p.lat[ j ] ) )
lat[ j ] <- ifelse(length(lat_j)>0,lat_j,NA)
lon_j 	<- as.numeric( xpathApply( OSM.Data, p.lon[ j ] ) )
lon[ j ] 	<-ifelse(length(lat_j)>0,lon_j,NA)
}
lon_i <- mean( lon ,na.rm=T)
lat_i <-  mean( lat,na.rm=T )
ind_k <- which(names(Liste_i)=="k")
ind_v <- which(names(Liste_i)=="v")
Liste[[i]] <- data.frame(k=Liste_i[ind_k],
v=Liste_i[ind_v],
id=rep(way_id[i],length(ind_k)),
lat=rep(lat_i,length(ind_k)),
lon=rep(lon_i,length(ind_k))
)
}
DF_schools <- do.call(rbind,Liste)
DF_schools
rcode.path <- "J:/Work/Statistik/Kolb/Paper/UseOSMdata/rcode"
setwd(rcode.path)
github.path <- "C:/Users/kolbjp/Documents/GitHub/GeoData"
setwd(github.path)
