---
title: "Pakete Choroplethr und DT"
author: "Jan-Philipp Kolb"
date: "08 April 2016"
output: md_document
---

```{r,echo=F}
library(knitr)
library(DT)
internet <- F
Nint <- !internet
```

## Einleitung

[`choroplethr`](https://cran.r-project.org/web/packages/choroplethr/index.html) - Vereinfachung der Erstellung von Choroplethen in R

Paket von [Ari Lamstein](http://www.arilamstein.com/)

[`WDI`](https://cran.r-project.org/web/packages/WDI/index.html)
- World Development Indicators (World Bank)

Folgendes basiert auf der [vignette](https://cran.r-project.org/web/packages/choroplethr/index.html) des `choroplethr`-Paketes

## Was ist ein Choropleth

Ein Choropleth ist eine Karte, die

- geografische Grenzen zeigt.
- bei denen Bereiche basierend auf Metriken eingefärbt werden.

Choropleths sind nützlich für die Visualisierung von Daten, wo geografische Grenzen eine natürliche Einheit der Aggregation sind. 

## Bevölkerungsschätzungen für den US-Staaten

```{r,warning=F,message=F,echo=F}
library("choroplethr")
data(df_pop_state)
```

`df_pop_state` ist ein Datensatz , der in dem Paket `choroplethr` enthalten ist, es enthält Schätzungen zu den US-Staaten für das Jahr 2012.

```{r,echo=F,eval=internet}
library("choroplethrMaps")
datatable(df_pop_state,options = list(pageLength = 5))
```

```{r,echo=F,eval=Nint}
kable(df_pop_state[1:10,])
```

## `choroplethr` - Hallo Welt

Hier ist ein Beispiel [choropleth](http://mirrors.softliste.de/cran/web/packages/choroplethr/vignettes/a-introduction.html) 

Die Karte zeigt die US State Bevölkerungsschätzung für das Jahr 2012:

Wir bekommen eine Choroplethenkarte mit nur einem Argument:

```{r}
state_choropleth(df_pop_state)
```


Aber wir können auch einen Titel erstellen und die Legende benennen:

```{r}
state_choropleth(df_pop_state, title="2012 US State Population Estimates", legend="Population")
```

## Nur drei Staaten darstellen

[US State Chroplethen](http://mirrors.softliste.de/cran/web/packages/choroplethr/vignettes/b-state-choropleth.html)

```{r}
state_choropleth(df_pop_state,
                 title      = "2012 Population Estimates",
                 legend     = "Population",
                 num_colors = 1,
                 zoom       = c("california", "washington", "oregon"))
```


## US County Chroplethen

[Choroplethen der US Counties](http://mirrors.softliste.de/cran/web/packages/choroplethr/vignettes/c-county-choropleth.html)

```{r,eval=F}
?df_pop_county

?county_choropleth
```


```{r}
data(df_pop_county)

county_choropleth(df_pop_county)
```


## [Country Choroplethen ](http://mirrors.softliste.de/cran/web/packages/choroplethr/vignettes/d-country-choropleth.html)

```{r}
data(df_pop_country)

country_choropleth(df_pop_country,
                 title      = "2012 Population Estimates",
                 legend     = "Population",
                 num_colors = 1,
                 zoom       = c("united states of america", "mexico", "canada"))
```



## Weltbank Daten

```{r,cache=T,warning=F,message=F}
library(choroplethr)
library(WDI) 

choroplethr_wdi(code="SP.POP.TOTL", year=2012, title="2012 Population", num_colors=1)
```

## [Lebenserwartung](http://mirrors.softliste.de/cran/web/packages/choroplethr/vignettes/f-world-bank-data.html)

```{r,warning=F,message=F}
library(WDI) 
choroplethr_wdi(code="SP.DYN.LE00.IN", year=2012, title="2012 Life Expectancy")
```


## Animiert

```{r,cache=T}
data(df_president_ts)
```

Mit dem Fragezeichen bekommen wir Hilfe

```{r,eval=F}
?df_president_ts
```


## [Ein weiteres Beispiel](http://www.r-bloggers.com/how-to-change-the-reference-map-in-choroplethr/)


```{r,warning=F}
library(choroplethr)
library(choroplethrZip)
library(R6)
library(RgoogleMaps)
library(ggmap)
 
ZipChoroplethSatellite = R6Class("ZipChoroplethSatellite", inherit = ZipChoropleth,
  public = list(
 
    get_reference_map = function()
    {
      # note: center is (long, lat) but MaxZoom is (lat, long)
 
      center = c(mean(self$choropleth.df$long),
      mean(self$choropleth.df$lat))
 
      max_zoom = MaxZoom(range(self$choropleth.df$lat),
      range(self$choropleth.df$long))
 
      get_map(location = center,
        zoom    = max_zoom,
        maptype = "satellite",
        color   = "color")
    }
  )
)
```

## Satelitenkarte als Hintergrund

```{r}
data(df_zip_demographics)
df_zip_demographics$value = df_zip_demographics$per_capita_income
nyc_fips = c(36005, 36047, 36061, 36081, 36085)
  
c = ZipChoroplethSatellite$new(df_zip_demographics)
c$set_zoom_zip(state_zoom=NULL, county_zoom = nyc_fips, zip_zoom=NULL, msa_zoom=NULL)
c$set_num_colors(4)
c$title  = "2013 New York City ZIP Code Tabulated Areas"
c$legend = "Per Capita Income"
c$render_with_reference_map()
```

## Das datatable

```{r,cache=F,echo=F,warning=F,eval=internet}
datatable(df_president_ts, options = list(pageLength = 5))
```

- [datatable](http://www.htmlwidgets.org/showcase_datatables.html)

## Resourcen

```{r}
citation("choroplethr")
```


## Reference

```{r}
citation("DT")
```


## Resources / Links

- [Intro - What is a choropleth](https://cran.r-project.org/web/packages/choroplethr/vignettes/a-introduction.html)

- [Description](http://radar.oreilly.com/2014/01/new-choropleth-package-in-r.html) on the usage of the `choroplethr` package

- Plot the [US states](https://cran.r-project.org/web/packages/choroplethr/vignettes/b-state-choropleth.html) with `choroplethr`

- [Mapping World Bank Data](https://cran.r-project.org/web/packages/choroplethr/vignettes/f-world-bank-data.html) with `choroplethr`

- [Revolutions-blog](http://blog.revolutionanalytics.com/2014/01/easy-data-maps-with-r-the-choroplethr-package-.html) on the `choroplethr` package

- [trulia](http://www.trulia.com/tech/2014/01/15/the-choroplethr-package-for-r/)-blog on the `choroplethr` package

- [Presentation Ari Lamstein](http://www.r-bloggers.com/slides-for-my-upcoming-talk-mapping-census-data-in-r/) on the `choroplethr` package
