---
title: "Nutzung von GeoDaten in den Sozialwissenschaften - Webscraping"
author: "Jan-Philipp Kolb"
date: "07 April 2016"
output: beamer_presentation
---


```{r,echo=F,warning=F}
library(knitr)
Ex <- F
Ex1 <- F
Ex2 <- F
Ex3 <- F
Ex4 <- F
```

## Das R-Paket `XML`

Gaston Sanchez - [Basics of XML and HTML](https://www.dropbox.com/s/eyd4t9h7n9fx0du/getting_web_data_r3_basics_xml_html.pdf?dl=0)

```{r}
# install.packages("XML")
library(XML)
```


Einlesen einer Tabelle mit der Funktion `readHTMLTable`:

Beispieldaten für die Bundesländer

```{r,eval=Ex1,cache=T}
BLA_link <- "http://www.bergziege-owl.de/deutschland-
bundeslander-und-ihre-hauptstadte/"
BLA_tab <- readHTMLTable(BLA_link)
```

## Überblick über Daten

```{r,eval=Ex1}
BLA_tab <- BLA_tab[[1]]
```

```{r,eval=F,echo=F}
setwd("C:/Users/kolbjp/Documents/GitHub/GeoData/2016/slides/data")

save(BLA_tab,file="BLA_tab.RData")
```

```{r,echo=F}
load("data/BLA_tab.RData")
```



```{r,echo=F,eval=T}
kable(head(BLA_tab))
```

## Daten bearbeiten

Die erste Zeile ist die Überschrift:

```{r}
colnames(BLA_tab) <- c("Bundesländer","Hauptstädte")
```


Die erste Zeile entfernen:

```{r,eval=Ex1}
BLA_tab <- BLA_tab[-1,]
```



## Die Daten speichern

```{r,eval=F,echo=F}
setwd("D:/Eigene Dateien/Dokumente/GitHub/GeoData/data")
```

```{r,eval=F}
write.csv(BLA_tab,file="BLA_tab.csv")
```


## Das Paket `rvest`

```{r,eval=F,message=F}
install.packages("rvest")
```

```{r,eval=Ex2,cache=T}
library("rvest")

link <- "https://de.wikipedia.org/wiki/Fl%C3%BCchtlingskrise_in_Europa_ab_2015"
```


```{r,eval=F,echo=F}
link <- "https://de.wikipedia.org/wiki/Fl%C3%BC
chtlingskrise_in_Europa_ab_2015"
```

```{r}
link_data <- read_html(link)
```



```{r,eval=Ex2}
# parse the document for R representation:
mps.doc <- htmlParse(link_data)
```


Alle Tabellen bekommen:

```{r,eval=Ex2}
mps.tabs <- readHTMLTable(mps.doc) 
```

## Daten zu Asylanträgen bearbeiten

```{r,eval=Ex2}
mps.tabs <- mps.tabs[[2]]
refugeeTab <- mps.tabs[-c(1,34),]
```

```{r,echo=F,eval=F}
kable(head(mps.tabs))
```

|   |V1                      |V2      |V3   |
|:--|:-----------------------|:-------|:----|
|2  |Belgien Belgien         |44.665  |3,97 |
|3  |Bulgarien Bulgarien     |20.375  |2,83 |
|4  |Danemark Dänemark       |20.940  |3,70 |
|5  |Deutschland Deutschland |476.510 |5,87 |
|6  |Estland Estland         |230     |0,18 |
|7  |Finnland Finnland       |32.345  |5,91 |

```{r,eval=F,echo=F}
setwd("D:/Eigene Dateien/Dokumente/GitHub/GeoData/2016/slides/data")
save(refugeeTab,file="refugeeTab.RData")
```



## Geburtenrate

```{r,cache=T,eval=Ex3}
link2 <- "http://www.laenderdaten.de/bevoelkerung/
geburtenrate.aspx"
link_data2 <- read_html(link2)
doc <- htmlParse(link_data2)
tab <- readHTMLTable(doc)
tab1 <- tab[[2]]
```

```{r,echo=F,eval=F}
kable(head(tab1))
```

|Land |Â            |Geburtenrate |Weltrang |
|:----|:------------|:------------|:--------|
|     |Niger        |45,45        |1        |
|     |Mali         |44,99        |2        |
|     |Uganda       |43,79        |3        |
|     |Sambia       |42,13        |4        |
|     |Burkina Faso |42,03        |5        |
|     |Burundi      |42,01        |6        |

## Fertility Rate

```{r,cache=T}
link3 <- "https://en.wikipedia.org/wiki/List_of_sovereign_states_and_dependent_territories_by_fertility_rate"
link_data3 <- read_html(link3)
doc3 <- htmlParse(link_data3)
tab3 <- readHTMLTable(doc3)
tab4 <- tab3[[2]]
```

- [Die US Flughäfen und Fluglinien](http://www.sasanalysis.com/2013/06/the-us-airports-with-most-flight-routes.html)

<http://www.sasanalysis.com/2013/06/the-us-airports-with-most-flight-routes.html>

- Mehr Daten - <http://openflights.org/data.html>

```{r,eval=F}
link1 <- "http://openflights.svn.sourceforge.net/viewvc/openflights/
openflights/data/airports.dat"
airport <- read.csv(link1, header = F)

link2 <- "http://openflights.svn.sourceforge.net/viewvc/openflights/
openflights/data/routes.dat"
route <- read.csv(link2, header = F)
```



## Links

Beispiel: [GiventheData](http://giventhedata.blogspot.de/2012/08/r-and-web-for-beginners-part-iii.html)

[Five easy steps for webscraping](http://www.unt.edu/rss/class/Jon/Benchmarks/ScrapingData_L_JDS_Nov2013.pdf)

## Reference XML

```{r}
citation("XML")
```

## Reference `rvest`

```{r}
citation("rvest")
```

