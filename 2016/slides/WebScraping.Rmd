---
title: "Webscraping"
author: "Jan-Philipp Kolb"
date: "Wed Oct 14 11:19:52 2015"
output: html_document
---


```{r,echo=F,warning=F}
library(knitr)
Ex <- F
Ex1 <- F
Ex2 <- T
Ex3 <- F
Ex4 <- F
```

## Das R-Paket `XML`

Gaston Sanchez - [Basics of XML and HTML](https://www.dropbox.com/s/eyd4t9h7n9fx0du/getting_web_data_r3_basics_xml_html.pdf?dl=0)

```{r}
# install.packages("XML")
library(XML)
```


Einlesen einer Tabelle mit der Funktion `readHTMLTable`:

Beispieldaten für die Bundesländer
```{r,eval=Ex1,cache=T}
BLA_link <- "http://www.bernhard-gaul.de/wissen/
bundeslaender.php"
BLA_tab <- readHTMLTable(BLA_link)
```

## Überblick über die Daten

```{r,eval=Ex1}
BLA_tab <- BLA_tab[[1]]
```


```{r,echo=F,eval=Ex1}
kable(BLA_tab)
```


## Daten bearbeiten

Die erste und 18. Zeile entfernen:

```{r,eval=Ex1}
BLA_tab <- BLA_tab[-c(1,18),-1]
```


## Die Daten editieren

```{r,eval=Ex1}
mean(BLA_tab[,2])
```

um dies zu ändern ist ein wenig Kosmetik notwendig:

```{r,eval=Ex1}
BLA_tab[,2] <- gsub(" ","",BLA_tab[,2])
BLA_tab[,2] <- gsub(",",".",BLA_tab[,2])
BLA_tab[,2] <- as.numeric(BLA_tab[,2])
```


```{r,eval=Ex1}
mean(BLA_tab[,2])
```


## Die weiteren Spalten bearbeiten

```{r,eval=Ex1}
BLA_tab[,3] <- as.numeric(gsub(" ","",BLA_tab[,3]))
BLA_tab[,4] <- as.numeric(gsub(" ","",BLA_tab[,4]))
```

Das Editing ist also aufwändiger als das eigentliche Scraping

## Die Daten speichern

```{r,eval=F,echo=F}
setwd("D:/Eigene Dateien/Dokumente/GitHub/GeoData/data")
```

```{r,eval=F}
write.csv(BLA_tab,file="BLA_tab.csv")
```


## Das Paket `rvest`

```{r,eval=F,message=F}
install.packages("rvest")
```

```{r,eval=Ex2,cache=T}
library("rvest")

link <- "https://de.wikipedia.org/wiki/Fl%C3%BCchtlingskrise_in_Europa_ab_2015"

link_data <- read_html(link)
```

```{r,eval=Ex2}
# parse the document for R representation:
mps.doc <- htmlParse(link_data)
```


Alle Tabellen bekommen:

```{r,eval=Ex2}
mps.tabs <- readHTMLTable(mps.doc) 
```

## Daten zu Asylanträgen

```{r,eval=Ex2}
mps.tabs
```

## Daten bearbeiten

```{r,eval=Ex2}
mps.tabs <- mps.tabs[[2]]
mps.tabs <- mps.tabs[-c(1,34),]
```

## Geburtenrate

```{r,cache=T,eval=Ex3}
link2 <- "http://www.laenderdaten.de/bevoelkerung/geburtenrate.aspx"
link_data2 <- read_html(link2)
doc <- htmlParse(link_data2)
tab <- readHTMLTable(doc)
tab1 <- tab[[2]]
```

```{r,cache=T}
link3 <- "https://en.wikipedia.org/wiki/List_of_sovereign_states_and_dependent_territories_by_fertility_rate"
link_data3 <- read_html(link3)
doc3 <- htmlParse(link_data3)
tab3 <- readHTMLTable(doc3)
tab4 <- tab3[[2]]
```

## Links

Beispiel: [GiventheData](http://giventhedata.blogspot.de/2012/08/r-and-web-for-beginners-part-iii.html)

[Five easy steps for webscraping](http://www.unt.edu/rss/class/Jon/Benchmarks/ScrapingData_L_JDS_Nov2013.pdf)

## Reference XML

```{r}
citation("XML")
```

## Reference `rvest`

```{r}
citation("rvest")
```

