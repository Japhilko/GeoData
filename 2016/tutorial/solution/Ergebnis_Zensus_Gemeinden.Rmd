---
title: "Nutzung von GeoDaten in den Sozialwissenschaften - Lösung Zensus Ergebnisse"
author: "Jan-Philipp Kolb"
date: "2 April 2016"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Datenquelle

- Bei [Destatis](https://www.destatis.de/DE/Methoden/Zensus_/Zensus.html) können die Daten herunter geladen werden.
- Endung hinten muss gelöscht werden, damit man nur noch .zip-Datei hat.
- Tabellenkopf muss gelöscht werden

![TabellenKopf](https://raw.githubusercontent.com/Japhilko/GeoData/master/data/figure/ZensusTabellenKopf.PNG)

```{r,echo=F}
Ex <- F
```


## Tabellenkopf bei Excel Daten

![tabk2](https://raw.githubusercontent.com/Japhilko/GeoData/master/data/figure/Tabellenkopf2.PNG)

## Import in R

```{r,eval=Ex,echo=F}
setwd("D:/GESIS/Workshops/GeoDaten/data")
```


Erste Möglichkeit:

```{r,eval=Ex}
library(readxl)
dat <- read_excel("TABELLE_2F.xls",3)
```

Zweite Möglichkeit:

- Daten als csv abspeichern und dann erst einlesen

- Optionen, damit der AGS richtig dargestellt wird:

```{r,eval=Ex}
options("scipen"=100, "digits"=4)
```

- Deutsche csv-Dateien einlesen mit `read.csv2`:

```{r,eval=Ex}
dat <- read.csv2("TABELLE_2F.csv")
```


## Daten bearbeiten

```{r,eval=Ex}
AGS <- dat[,2]
Gnamen <- dat[,3]
Bev <- dat[,4]
Bev1 <- dat[,5]
Bev20 <- dat[,25]

Bev <- as.numeric(gsub(" ","",Bev))
Bev1 <- as.numeric(gsub(" ","",Bev1))
Bev20 <- as.numeric(gsub(" ","",Bev20))
```

## Datensatz erzeugen 

```{r,eval=Ex}
zdat <- data.frame(AGS,Gnamen,Bev,Bev1,Bev20)
```

## Der amtliche Gemeindeschlüssel

- AGS bei [Wikipedia](https://de.wikipedia.org/wiki/Amtlicher_Gemeindeschl%C3%BCssel)
- 1.–2. Stelle = Kennzahl des Bundeslandes

```{r,eval=Ex}
AGS2 <- substr(AGS,1,2)

library(lattice)
barchart(table(AGS2))
```

![AGStab](https://raw.githubusercontent.com/Japhilko/GeoData/master/data/figure/AGStab.png)

## Unterauswahl für das Saarland

```{r,eval=Ex}
datSAL <- zdat[AGS2=="10" & nchar(AGS)==9,]
```

## Wo ist der Anteil am Größten

```{r,eval=Ex}
ant <- datSAL$Bev1/datSAL$Bev
which.max(ant)
datSAL[15,]
```

## Den Datensatz abspeichern

```{r,echo=F,eval=Ex}
setwd("D:/Eigene Dateien/Dokumente/GitHub/GeoData/2016/slides/data")
```

```{r,eval=Ex}
write.csv(datSAL,"datSAL.csv")
```

