---
title: "Download and work with data from OpenStreetMap"
author: "Jan-Philipp Kolb"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,cache=F,eval=T,message=F,warning=F)
```


## Introduction

The `geosmdata` package is designed to download and process data from OpenStreetMap. Different API's are used to access the data. The package is a wrapper for some of these APIs. The functions available in this package are described in the following. 

```{r}
library("geosmdata")
```

## Geocoding with [Nominatim](http://wiki.openstreetmap.org/wiki/Nominatim)

We can use the [Nominatim](http://wiki.openstreetmap.org/wiki/Nominatim) functionality to get a geocode for the specified place. In the default we only get the longitude and latitude coordinates. 


```{r}
gc <- geocode_osm("rue Saint Vincent Paris")
gc
```

If we want more information we have to use the value "all" in the argument output.

```{r}
gc_all <- geocode_osm("rue Saint Vincent Paris",output="all")
gc_all
```


## Get information on points of interest (POI)

The [Overpass](http://wiki.openstreetmap.org/wiki/Overpass_API)-API is used to get information for specific OpenStreetMap objects. The available map features and their key-value pairs are described on the [wiki page](http://wiki.openstreetmap.org/wiki/Map_Features).

```{r}
pg_MA <- get_osm_nodes(object="leisure=playground",place="Mannheim")
```

Some problems can occur for special characters like umlaute. 
The result is an osm object in xml format. It contains information about the nodes. We have to extract this information in a next step. 

```{r}
info <- extract_osm_nodes(OSM.Data=pg_MA,value="playground")
```

## Download nodes within a given boundary

Beside specifying a place for which we want the POI's we can also define a bounding box. 

```{r}
objectI <- "leisure=playground"
boundaryI <- "50.6,7.0,50.8,7.3"
osm_obj <- nodes4boundaries(objectI,boundaryI)
```


# Plotting the OSM-information

The `ggmap` function from package [ggmap](https://cran.r-project.org/web/packages/ggmap/index.html) can be used to download a background map. 


```{r stamenMap,message=F,cache=T}
library("ggmap")
place_map12stamen <- qmap("Mannheim", zoom = 12,maptype="toner-lite",source="stamen")
```

Then we can plot the POI's as points on the stamen map.

```{r}
place_map12stamen + geom_point(aes(x = lon, y = lat),data = info,size=3,col="red") 
```

## Download Boundaries

The Nominatim API can also be used to download information on boundaries. 

```{r}
BE_geom <- getgeometry('Berlin')
spobject <- extractpoly(BE_geom,'Berlin')
plot(spobject)
```

