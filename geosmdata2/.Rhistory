classD<-trees[trees$CC=='D',]
classD$fpc<-rep(fpcvals[1], nrow(classD))
# Pull off stratum S observations
classS<-trees[trees$CC=='S',]
classS$fpc<-rep(fpcvals[2], nrow(classS))
set.seed(100)
d.sample<-sample(1:nrow(classD),nd,replace=F)
s.sample<-sample(1:nrow(classS),ns,replace=F)
strat.samp<-rbind(classD[d.sample,], classS[s.sample,])
strat.obj<-svydesign(id=~1, strata=~CC, data=strat.samp, fpc=~fpc)
plot.list<-sort(unique(trees$SubPlot))
num.plots <- length(plot.list)
my.plot<-plot.list[sample(1:num.plots,3)]
cluster.sample<-trees[trees$SubPlot %in% my.plot,]
cluster.obj<-svydesign(id=~SubPlot, fpc=rep(num.plots, nrow(cluster.sample)), data=cluster.sample)
set.seed(200)
#sample from the list of the plot names
cluster.list <- plot.list[sample(1:num.plots, 6, F)]
clust.samp2<-NULL
for(i in 1:length(cluster.list)) {
cur.clust <- trees[trees$SubPlot == cluster.list[i],]
cur.sample <- cur.clust[sample(1:nrow(cur.clust),50,F),]
cur.sample$fpc2 <- rep(nrow(cur.clust),50)
clust.samp2 <- rbind(clust.samp2, cur.sample)
}
clust.samp2$obs <- 1:300
clust.samp2$fpc1 <- rep(60, nrow(clust.samp2))
svydesign(id=~SubPlot+obs, fpc=~fpc1+fpc2, data=clust.samp2) -> two.stage
svymean(~Diameter_cm,two.stage)
clust.samp2$obs
rm(list=ls())
author <- "Siegfried Gabler, Jan-Philipp Kolb"
scriptname <- "WeightALL_D_SurveyPackage.R"
#---------------------------------------#
# libraries
#---------------------------------------#
library(survey)
#---------------------------------------#
# Paths
#---------------------------------------#
path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/data"
r.path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper"
#---------------------------------------#
# Read data
#---------------------------------------#
setwd(path)
load("ALLBUSweights.RData")
x_ALL <- x
load("ALLBUS10Vars.RData")
Descr <- Vars[-c(1:3),3]
Variablen <- as.character(Vars[-c(1:3),1])
nVars <- c("p_inklusion","gewfake","pointint","bikregbez","bikbula","regbez","v942","v762","v977","deutsch","v976")
Nind <- match(nVars,Variablen)
Variablen <- Variablen[-Nind]
ErgList_survey <-list()
# for(j in 1:length(Variablen)){
j <- 2
nr       <- match(Variablen[j],colnames(x))
x <- x_ALL
x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelöscht
#---------------------------------------#
# Compute mean etc for western Germany
#---------------------------------------#
# West
N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West
K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt
Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt
x_West    <- subset(x,x$v5==1)
tab_lev <- table(x_West[,nr])
ID <- 1:nrow(x_West)
x_West$fpcA <- rep(N_West,nrow(x_West))
i <- 1
# for (i in 1:length(tab_lev)){
x_West <- x_West[order(x_West$v762),]
ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+Mi)
Erg_surv <- svymean(~ys_West2, dclus_ALLB, deff=TRUE)
Erg_of <- sig_hat(ys=ys_West,
Mi=x_West$Mi,
PSU=x_West$PSU,
sPSU=x_West$v762,
N=N_West,
K=K_West)
# }
rm(list=ls())
author <- "Siegfried Gabler, Jan-Philipp Kolb"
scriptname <- "WeightALL_D_SurveyPackage.R"
#---------------------------------------#
# libraries
#---------------------------------------#
library(survey)
#---------------------------------------#
# Paths
#---------------------------------------#
path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/data"
r.path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper"
#---------------------------------------#
# Read data
#---------------------------------------#
setwd(path)
load("ALLBUSweights.RData")
x_ALL <- x
load("ALLBUS10Vars.RData")
#---------------------------------------#
# Read functions
#---------------------------------------#
setwd(r.path)
source("WeightALL_B_functions.R")
#---------------------------------------#
# Choose variables for analysis
#---------------------------------------#
Descr <- Vars[-c(1:3),3]
Variablen <- as.character(Vars[-c(1:3),1])
nVars <- c("p_inklusion","gewfake","pointint","bikregbez","bikbula","regbez","v942","v762","v977","deutsch","v976")
Nind <- match(nVars,Variablen)
Variablen <- Variablen[-Nind]
ErgList_survey <-list()
# for(j in 1:length(Variablen)){
j <- 2
nr       <- match(Variablen[j],colnames(x))
x <- x_ALL
x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelöscht
#---------------------------------------#
# Compute mean etc for western Germany
#---------------------------------------#
# West
N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West
K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt
Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt
x_West    <- subset(x,x$v5==1)
tab_lev <- table(x_West[,nr])
ID <- 1:nrow(x_West)
x_West$fpcA <- rep(N_West,nrow(x_West))
i <- 1
# for (i in 1:length(tab_lev)){
x_West <- x_West[order(x_West$v762),]
ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+Mi)
Erg_surv <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
Erg_of <- sig_hat(ys=ys_West,
Mi=x_West$Mi,
PSU=x_West$PSU,
sPSU=x_West$v762,
N=N_West,
K=K_West)
# }
Erg_of
Erg_surv
x_West$Mi
head(x_West)
dclus_ALLB <-svydesign(id=~PSU+ID,data=x_West,fpc=~fpcA+Mi)
Erg_surv <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
Erg_surv
Erg_of
rm(list=ls())
author <- "Siegfried Gabler, Jan-Philipp Kolb"
scriptname <- "WeightALL_D_SurveyPackage.R"
#---------------------------------------#
# libraries
#---------------------------------------#
library(survey)
#---------------------------------------#
# Paths
#---------------------------------------#
path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/data"
r.path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper"
#---------------------------------------#
# Read data
#---------------------------------------#
setwd(path)
load("ALLBUSweights.RData")
x_ALL <- x
load("ALLBUS10Vars.RData")
#---------------------------------------#
# Read functions
#---------------------------------------#
setwd(r.path)
source("WeightALL_B_functions.R")
#---------------------------------------#
# Choose variables for analysis
#---------------------------------------#
Descr <- Vars[-c(1:3),3]
Variablen <- as.character(Vars[-c(1:3),1])
nVars <- c("p_inklusion","gewfake","pointint","bikregbez","bikbula","regbez","v942","v762","v977","deutsch","v976")
Nind <- match(nVars,Variablen)
Variablen <- Variablen[-Nind]
ErgList_survey <-list()
# for(j in 1:length(Variablen)){
j <- 2
nr       <- match(Variablen[j],colnames(x))
x <- x_ALL
x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelöscht
#---------------------------------------#
# Compute mean etc for western Germany
#---------------------------------------#
# West
N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West
K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt
Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt
x_West    <- subset(x,x$v5==1)
tab_lev <- table(x_West[,nr])
ID <- 1:nrow(x_West)
x_West$fpcA <- rep(N_West,nrow(x_West))
i <- 1
# for (i in 1:length(tab_lev)){
x_West <- x_West[order(x_West$PSU),]
ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+Mi)
Erg_surv <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
Erg_of <- sig_hat(ys=ys_West,
Mi=x_West$Mi,
PSU=x_West$PSU,
sPSU=x_West$v762,
N=N_West,
K=K_West)
# }
Erg_surv
Erg_of
x_West$Mi
rm(list=ls())
author <- "Siegfried Gabler, Jan-Philipp Kolb"
scriptname <- "WeightALL_D_SurveyPackage.R"
#---------------------------------------#
# libraries
#---------------------------------------#
library(survey)
#---------------------------------------#
# Paths
#---------------------------------------#
path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/data"
r.path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper"
#---------------------------------------#
# Read data
#---------------------------------------#
setwd(path)
load("ALLBUSweights.RData")
x_ALL <- x
load("ALLBUS10Vars.RData")
#---------------------------------------#
# Read functions
#---------------------------------------#
setwd(r.path)
source("WeightALL_B_functions.R")
#---------------------------------------#
# Choose variables for analysis
#---------------------------------------#
Descr <- Vars[-c(1:3),3]
Variablen <- as.character(Vars[-c(1:3),1])
nVars <- c("p_inklusion","gewfake","pointint","bikregbez","bikbula","regbez","v942","v762","v977","deutsch","v976")
Nind <- match(nVars,Variablen)
Variablen <- Variablen[-Nind]
ErgList_survey <-list()
# for(j in 1:length(Variablen)){
j <- 2
nr       <- match(Variablen[j],colnames(x))
x <- x_ALL
x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelöscht
#---------------------------------------#
# Compute mean etc for western Germany
#---------------------------------------#
# West
N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West
K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt
Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt
x_West    <- subset(x,x$v5==1)
tab_lev <- table(x_West[,nr])
ID <- 1:nrow(x_West)
x_West$fpcA <- rep(N_West,nrow(x_West))
i <- 1
# for (i in 1:length(tab_lev)){
# x_West <- x_West[order(x_West$PSU),]
ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+Mi)
Erg_surv <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
Erg_of <- sig_hat(ys=ys_West,
Mi=x_West$Mi,
PSU=x_West$PSU,
sPSU=x_West$v762,
N=N_West,
K=K_West)
# }
#
#     mean       SE   DEff
#     ys_West 0.013234 0.006414 6.1497
#   ErgList[[j]] <-  erg_West
# }
#----------------------------
Erg_surv
Erg_of
dclus_ALLB <-svydesign(id=~v762,data=x_West,fpc=~fpcA+Mi)
dclus_ALLB <-svydesign(id=~v762,data=x_West,fpc=~fpcA)
Erg_surv <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
Erg_surv
ind <- match(x_West$v762,names(tab_v762))
tab_v762 <- table(x_West$v762)
ind <- match(x_West$v762,names(tab_v762))
x_West$fpcB <- tab_v762[ind]
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+fpcB)
Erg_surv <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
Erg_surv
#---------------------------------------#
# Survey Weighting with ALLBUS data
# Jan-Philipp Kolb und Siegfried Gabler
# Fri Jul 03 09:39:49 2015
#---------------------------------------#
# R version 3.1.2 (2014-10-31) -- "Pumpkin Helmet"
# Platform: x86_64-w64-mingw32/x64 (64-bit)
#---------------------------------------#
# Generalities
#---------------------------------------#
rm(list=ls())
author <- "Siegfried Gabler, Jan-Philipp Kolb"
scriptname <- "WeightALL_D_SurveyPackage.R"
#---------------------------------------#
# libraries
#---------------------------------------#
library(survey)
#---------------------------------------#
# Paths
#---------------------------------------#
path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/data"
r.path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper"
#---------------------------------------#
# Read data
#---------------------------------------#
setwd(path)
load("ALLBUSweights.RData")
x_ALL <- x
load("ALLBUS10Vars.RData")
#---------------------------------------#
# Read functions
#---------------------------------------#
setwd(r.path)
source("WeightALL_B_functions.R")
#---------------------------------------#
# Choose variables for analysis
#---------------------------------------#
Descr <- Vars[-c(1:3),3]
Variablen <- as.character(Vars[-c(1:3),1])
nVars <- c("p_inklusion","gewfake","pointint","bikregbez","bikbula","regbez","v942","v762","v977","deutsch","v976")
Nind <- match(nVars,Variablen)
Variablen <- Variablen[-Nind]
ErgList_survey <-list()
for(j in 1:length(Variablen)){
# j <- 2
nr       <- match(Variablen[j],colnames(x))
x <- x_ALL
x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelöscht
#---------------------------------------#
# Compute mean etc for western Germany
#---------------------------------------#
# West
N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West
K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt
Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt
x_West    <- subset(x,x$v5==1)
tab_lev <- table(x_West[,nr])
erg_West <- data.frame(Variable=Variablen[j],
Level=names(tab_lev),
Estimator.mean=NA,
Variance.estimator=NA,
Estimator.for.sigma.2=NA,
Sampling.variance=NA,
mean_survey=NA,
SE_survey=NA,
DEff_survey=NA
)
ID <- 1:nrow(x_West)
x_West$fpcA <- rep(N_West,nrow(x_West))
tab_v762 <- table(x_West$v762)
ind <- match(x_West$v762,names(tab_v762))
x_West$fpcB <- tab_v762[ind]
#  i <- 1
for (i in 1:length(tab_lev)){
ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])
# dclus_ALLB <-svydesign(id=~v762,data=x_West,fpc=~fpcA)
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+fpcB)
erg_West[i,3:6] <-  sig_hat(ys=ys_West,
Mi=x_West$Mi,
PSU=x_West$PSU,
sPSU=x_West$v762,
N=N_West,
K=K_West)
erg_West[i,7:9] <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
}
ErgList[[j]] <-  erg_West
}
#---------------------------------------#
# Analysis
#---------------------------------------#
with(x_West,tapply(Mi,v762,unique))
with(x_West,tapply(Mi,v762,function(x)length(unique(x))))
Erg_df <- do.call(rbind,ErgList)
ErgList <-list()
#---------------------------------------#
# Survey Weighting with ALLBUS data
# Jan-Philipp Kolb und Siegfried Gabler
# Fri Jul 03 09:39:49 2015
#---------------------------------------#
# R version 3.1.2 (2014-10-31) -- "Pumpkin Helmet"
# Platform: x86_64-w64-mingw32/x64 (64-bit)
#---------------------------------------#
# Generalities
#---------------------------------------#
rm(list=ls())
author <- "Siegfried Gabler, Jan-Philipp Kolb"
scriptname <- "WeightALL_D_SurveyPackage.R"
#---------------------------------------#
# libraries
#---------------------------------------#
library(survey)
#---------------------------------------#
# Paths
#---------------------------------------#
path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/data"
r.path <- "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper"
#---------------------------------------#
# Read data
#---------------------------------------#
setwd(path)
load("ALLBUSweights.RData")
x_ALL <- x
load("ALLBUS10Vars.RData")
#---------------------------------------#
# Read functions
#---------------------------------------#
setwd(r.path)
source("WeightALL_B_functions.R")
#---------------------------------------#
# Choose variables for analysis
#---------------------------------------#
Descr <- Vars[-c(1:3),3]
Variablen <- as.character(Vars[-c(1:3),1])
nVars <- c("p_inklusion","gewfake","pointint","bikregbez","bikbula","regbez","v942","v762","v977","deutsch","v976")
Nind <- match(nVars,Variablen)
Variablen <- Variablen[-Nind]
ErgList <-list()
for(j in 1:length(Variablen)){
# j <- 2
nr       <- match(Variablen[j],colnames(x))
x <- x_ALL
x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelöscht
#---------------------------------------#
# Compute mean etc for western Germany
#---------------------------------------#
# West
N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West
K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt
Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt
x_West    <- subset(x,x$v5==1)
tab_lev <- table(x_West[,nr])
erg_West <- data.frame(Variable=Variablen[j],
Level=names(tab_lev),
Estimator.mean=NA,
Variance.estimator=NA,
Estimator.for.sigma.2=NA,
Sampling.variance=NA,
mean_survey=NA,
SE_survey=NA,
DEff_survey=NA
)
ID <- 1:nrow(x_West)
x_West$fpcA <- rep(N_West,nrow(x_West))
tab_v762 <- table(x_West$v762)
ind <- match(x_West$v762,names(tab_v762))
x_West$fpcB <- tab_v762[ind]
#  i <- 1
for (i in 1:length(tab_lev)){
ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])
# dclus_ALLB <-svydesign(id=~v762,data=x_West,fpc=~fpcA)
dclus_ALLB <-svydesign(id=~v762+ID,data=x_West,fpc=~fpcA+fpcB)
erg_West[i,3:6] <-  sig_hat(ys=ys_West,
Mi=x_West$Mi,
PSU=x_West$PSU,
sPSU=x_West$v762,
N=N_West,
K=K_West)
erg_West[i,7:9] <- svymean(~ys_West, dclus_ALLB, deff=TRUE)
}
ErgList[[j]] <-  erg_West
}
Erg_df <- do.call(rbind,ErgList)
#---------------------------------------#
# Analysis
#---------------------------------------#
# with(x_West,tapply(Mi,v762,unique))
# with(x_West,tapply(Mi,v762,function(x)length(unique(x))))
Erg_df
head( Erg_df)
dir()
library(geosmdata2)
MA_cycle1 <- get_osm_ways(object2="cycleway",place="Mannheim")
MA_cycle1
setwd(main.path)
main.path <- "J:/Work/Statistik/Kolb/Paper/UseOSMdata/"
setwd(main.path)
MA_cycl1 <- extract_info_op(MA_cycle1,"cycleway")
extract_info_op
MA_cycl1
head(MA_cycl1)
unique(MA_cycl1$destination.forward)
osm_object <- MA_cycle1
xml_obj <- xmlRoot(osm_object)
xml_obj
extract_data
?extract_data
library(osmar)
?extract_data
osmar:::extract_data
library(osmar)
methods(extract_data)
abc <- osmar:::extract_data(xml_obj)
