{
    "contents" : "###################################################\n# Use the osm api xapi with R\n# Jan-Philipp Kolb\n# Mon Jun 15 17:50:39 2015\n#\n###################################################\n\n#------------------------------------------#\n# In general\n#------------------------------------------#\n\nauthor <- \"Jan-Philipp Kolb\"\nscriptname <- \"rOSM_E_USExapi.R\"\n\n#------------------------------------------#\n# Libraries\n#------------------------------------------#\n\nlibrary(XML)\nlibrary(RCurl)\n\n\n#------------------------------------------#\n# paths\n#------------------------------------------#\n\ndata.path <- \"D:/Daten/Daten/GeoDaten/XAPI\"\ngraph.path <- \"J:/Work/Statistik/Kolb/VortrÃ¤ge/20150617_Forschungsboerse/Folien/figure\"\n\n\n#------------------------------------------#\n# Functions\n#------------------------------------------#\n\n\ncreate_bbox <- function(location,box.value){\n  gc_loc <- geocode(location)\n\n  gc_loc_min <- gc_loc - box.value\n  gc_loc_max <- gc_loc + box.value\n  bbox_x <- paste(gc_loc_min$lon,gc_loc_min$lat,gc_loc_max$lon,gc_loc_max$lat,sep=\",\")\n}\n\n\n#------------------------------------------#\n# Download Info from xapi - Example 1\n#------------------------------------------#\n\n\nloc1=\"Mannheim Seckenheim\"\nobject_x=\"amenity=parking\"\nbv=0.05\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\n\nsetwd(\"D:/Daten/Daten/GeoDaten/XAPI\")\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nloc1 <- \"MASECK\"\nobject_x1 <- \"parking\"\nbv1 <- \"05\"\n\nsetwd(data.path)\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Download Info from xapi - Example 2 - bigger area\n#------------------------------------------#\n\nloc1=\"Mannheim Seckenheim\"\nobject_x=\"amenity=parking\"\nbv=0.06\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nsetwd(data.path)\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nloc1 <- \"MASECK\"\nobject_x1 <- \"parking\"\nbv1 <- \"06\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Download Info from xapi - Example 3 - even bigger area\n#------------------------------------------#\n\nloc1=\"Mannheim Seckenheim\"\nobject_x=\"amenity=parking\"\nbv=0.07\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nsetwd(data.path)\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nloc1 <- \"MASECK\"\nobject_x1 <- \"parking\"\nbv1 <- \"07\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n\n#------------------------------------------#\n# Download Info from xapi - Example 4 - even bigger area\n#------------------------------------------#\n\nbv=0.08\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nbv1 <- \"08\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Download Info from xapi - Example 5 - even bigger area\n#------------------------------------------#\n\nbv=0.09\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nbv1 <- \"09\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Download Info from xapi - Example 6 - even bigger area\n#------------------------------------------#\n\nbv=0.1\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nbv1 <- \"f1\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Download Info from xapi - Example 6 - even bigger area\n#------------------------------------------#\n\nbv=0.1\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nbv1 <- \"f1\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Download Info from xapi - Example 7 - other location\n#------------------------------------------#\n\nloc1=\"Speyer\"\n\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nbv1 <- \"f1\"\n\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\n#------------------------------------------#\n# Get info from XML\n#------------------------------------------#\n\n# http://www.informit.com/articles/article.aspx?p=2215520\n\nxmltop = xmlRoot(xapi_x)\n\nxmlSApply(xmltop, xmlName) #name(s)\n\nxmlAttrs(xmltop[[1]])\n\n# http://www.omegahat.org/RSXML/Tour.pdf\ninfo <- xmlSApply(xmltop, xmlAttrs) #name(s)\n\nrow.names(info)\n\nListPOI <- data.frame(lat=as.numeric(info[\"lat\",]),lon=as.numeric(info[\"lon\",]))\n\n#------------------------------------------#\n# Draw a map with results\n#------------------------------------------#\n\nSPmap <- qmap(\"Speyer\",zoom=10)\n\nsetwd(graph.path)\npng(\"SPmap_parking.png\")\nSPmap +\n  geom_point(aes(x = lon, y = lat),\n             data = ListPOI)\ndev.off()\n\n\n#------------------------------------------#\n# Download Info from xapi - Example 8 - other map feature\n#------------------------------------------#\n\nobject_x=\"amenity=school\"\nloc1=\"Speyer\"\nbv=0.01\n\nbb_SK <- create_bbox(loc1,bv)\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\n                         \"%5D%5Bbbox=\",bb_SK,\"%5D\",sep=\"\"))\n\nattr(xapi_x,\"Info\") <- paste(author,scriptname,date())\nbv1 <- \"f1\"\nsetwd(data.path)\nsave(xapi_x,file=paste(\"xapi_HD_\",loc1,\"_\",bv1,\"_\",object_x1,\".RData\",sep=\"\"))\n\nxmltop = xmlRoot(xapi_x)\ninfo_school <- xmlSApply(xmltop, xmlAttrs) #name(s)\n\nncol(info_school)\n\n#------------------------------------------#\n# Get more info from XML\n#------------------------------------------#\nr <- xmltop\n\nr_length <- xmlSize(r)\nschool_info <- list()\n\nfor (i in 1:r_length){\n  school_info[[i]] <- xmlSApply(r[[i]], xmlAttrs)\n}\n\n\n\ndf_schools <- data.frame(t(unlist(xmlSApply(r, xmlAttrs) )))\n\ndf_schools$name <- NA\n\nfor (i in 1:nrow(df_schools)){\n  df_schools$name[i] <- school_info[[i]][\"v\",which(school_info[[i]][\"k\",]==\"name\")]\n}\n\ndf_schools$lat <- as.numeric(df_schools$lat)\ndf_schools$lon <- as.numeric(df_schools$lon)\n\nSPmap +\n  geom_point(aes(x = lon, y = lat),\n             data = df_schools)\n\n\n\n\n#------------------------------------------#\n# Links\n#------------------------------------------#\n\n# r-project + open street map + geocode\n# http://www.gisgraphy.com/\n\n# xapi explained in german\n# http://wiki.openstreetmap.org/wiki/DE:Xapi#Kommentar\n",
    "created" : 1434372470821.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1377133497",
    "id" : "D17F8E3B",
    "lastKnownWriteTime" : 1434383470,
    "path" : "J:/Work/Statistik/Kolb/Paper/UseOSMdata/rcode/rOSM_E_USExapi.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}