{
    "contents" : "---\ntitle: \"Use xapi\"\nauthor: \"Jan-Philipp Kolb\"\ndate: \"12. Juni 2015\"\noutput: html_document\n---\n\n```{r,eval=F,echo=F}\npath <- \"C:/Users/kolbjp/Documents/GitHub/GeoData/workshops\"\nsetwd(path)\n```\n\n\n\n```{r}\nlibrary(XML)\n```\n\n\n## Download specific information\n\nmapquest Xapi Service:\n\n<http://open.mapquestapi.com/xapi/>\n\n\nOrganisation of bounding box:\n\n[left,bottom,right,top]\n\nor:\n\n[east,south,west,north]\n\nor:\n\n[lon.min,lat.min,lon.max,lat.max]\n\n\nfor example Mannheim Seckenheim:\n\n[8.5382,49.4573,8.5808,49.4759]\n\nLinks to download information from this section:\n\n<http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=8.5382,49.4573,8.5808,49.4759%5D>\n\n<http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=-77.041579,38.885851,-77.007247,38.900881%5D>\n\n```{r}\nab <- xmlParse(\"http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=-77.041579,38.885851,-77.007247,38.900881%5D\")\n\nbbox <- \"-77.041579,38.885851,-77.007247,38.900881\"\nabc <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=\",bbox,\"%5D\",sep=\"\"))\n```\n\nFinding a specific place\n\n```{r}\nlibrary(ggmap)\n  # lon - east west\n  # lat - south north\nMAcode1 <- geocode(\"Mannheim Sandhofen\")\nMAcode2 <- geocode(\"Mannheim Rheinau\")\n\nMAcode3 <- geocode(\"Mannheim Schloss\")\nMAcode4 <- geocode(\"Mannheim Wallstadt\")\n\n  # [left,bottom,right,top]\nbbox2 <- paste(MAcode3$lon,MAcode2$lat,MAcode4$lon,MAcode1$lat,sep=\",\")\nabcd <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=\",bbox2,\"%5D\",sep=\"\"))\n```\n\n\n\n```{r}\nlibrary(raster)\nLUX3 <- getData('GADM', country='LUX', level=3)\n\nLUXT <- LUX3[LUX3@data$NAME_3==\"Troisvierges\",]\n```\n\n```{r}\nlibrary(sp)\nbLUXT <- bbox(LUXT)\nbbox3 <- paste(bLUXT[1,1],bLUXT[2,1],bLUXT[1,2],bLUXT[2,2],sep=\",\")\nabct <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=\",bbox3,\"%5D\",sep=\"\"))\n```\n\n\n```{r}\nsetwd(\"D:/Daten/Daten/GeoDaten\")\nlibrary(rgdal)\nPLZ <- readOGR (\"post_pl.shp\",\"post_pl\")\nMA <- PLZ[PLZ@data$PLZORT99==\"Mannheim\",]\nbMA <- bbox(MA)\n\nMA2 <- PLZ[PLZ@data$PLZ99==\"68159\",]\nbMA2 <- bbox(MA2)\n\nbbox4 <- paste(bMA[1,1],bMA[2,1],bMA[1,2],bMA[2,2],sep=\",\")\nabcm <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5Bamenity=pub%5D%5Bbbox=\",bbox4,\"%5D\",sep=\"\"))\n```\n\n\n```{r}\nList_abcm <- xmlToList(abcm)\n\nList_abcm[[1]][2]\n\nList_abcm[[2]][2]\n```\n\n\n```{r}\nxList<- lapply(List_abcm,unlist)\n\nListEl <- xList[[1]]\nListEl[which(ListEl==\"name\")+1]\n```\n\n\n\n```{r}\nabce <- xmlParse(\"http://open.mapquestapi.com/xapi/api/0.6/node[amenity=pub][bbox=8.41420088819042,49.467729452325514,8.551529989747436,49.517905125443455]\")\n```\n\n## Getting different map features\n\n<http://wiki.openstreetmap.org/wiki/Map_Features>\n```{r}\n\nbb_x=bbox(MA)\n\nobject_x=\"leisure=playground\"\n\nrequest_xapi <- function(bb_x,object_x){\n  bbox_x <- paste(bb_x[1,1],bb_x[2,1],bb_x[1,2],bb_x[2,2],sep=\",\")\n  xapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\"%5D%5Bbbox=\",bbox_x,\"%5D\",sep=\"\"))\n}\n\nMA_pg <-  request_xapi(bb_x=bbox(MA),object_x=\"leisure=playground\")\n\n\nMA_bakery <-  request_xapi(bb_x=bbox(MA),object_x=\"shop=bakery\")\n```\n\n## How to create a bounding box:\n\n```{r}\nlibrary(ggmap)\n\ngc_HD <- geocode(\"Heidelberg\")\n\nbox.value <- 0.0075\n\ngc_HD_min <- gc_HD - box.value\ngc_HD_max <- gc_HD + box.value\n\n# [lon.min,lat.min,lon.max,lat.max]\nbbox_x <- paste(gc_HD_min$lon,gc_HD_min$lat,gc_HD_max$lon,gc_HD_max$lat,sep=\",\")\nobject_x=\"leisure=playground\"\nxapi_x <- xmlParse(paste(\"http://open.mapquestapi.com/xapi/api/0.6/node%5B\",object_x,\"%5D%5Bbbox=\",bbox_x,\"%5D\",sep=\"\"))\n```\n\n## Possibility to save results:\n\n```{r,echo=F,eval=F}\nsetwd(\"D:/Daten/Daten/GeoDaten/XAPI\")\n```\n\n```{r,eval=F}\nobject_x1 <- \"playground\"\nsave(xapi_x,file=paste(\"xapi_HD_\",object_x1,\".RData\",sep=\"\"))\n```\n\n## Another Example\n\n```{r}\ncity <- \"Schwetzingen\"\nobject_x=\"amenity=school\"\n\ngc_ct <- geocode(city)\n\ngc_HD_min <- gc_HD - box.value\ngc_HD_max <- gc_HD + box.value\nbbox_x <- paste(gc_HD_min$lon,gc_HD_min$lat,gc_HD_max$lon,gc_HD_max$lat,sep=\",\")\n\n```\n\n\n\n## Links\n\nWorking with XML files:\n\n<http://www.informit.com/articles/article.aspx?p=2215520>\n\n\n\n<http://gis.stackexchange.com/questions/18124/how-do-i-download-specific-openstreetmap-data-by-tag>\n\n\nDefining an adequate bounding box:\n\n<http://gis.stackexchange.com/questions/46954/clip-spatial-object-to-bounding-box-in-r>\n\nClipping spatial data in R:\n\n<http://robinlovelace.net/r/2014/07/29/clipping-with-r.html>\n",
    "created" : 1434099513455.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3375278686",
    "id" : "FA008A7",
    "lastKnownWriteTime" : 1434361363,
    "path" : "~/GitHub/GeoData/workshops/J_xapi.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 15,
    "source_on_save" : false,
    "type" : "r_markdown"
}