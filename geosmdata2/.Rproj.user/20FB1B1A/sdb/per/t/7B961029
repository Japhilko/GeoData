{
    "contents" : "#----------------------------------------------#\n# Panel Gewichte pairfam\n# Ursprung LMU Muenchen\n# Ueberarbeitung Jan-Philipp Kolb\n# Tue Jun 23 08:29:10 2015\n#----------------------------------------------#\n\nauthor <- \"Jan-Philipp Kolb\"\nscriptname <- \"aw2_gewichtung_jpk.R\"\n\n#-----------------------------------------------------#\n# Bibliotheken\n#-----------------------------------------------------#\n\nlibrary(foreign)\nlibrary(car)\nlibrary(xtable)\n\n#-----------------------------------------------------#\n# Pfade definieren\n#-----------------------------------------------------#\nmain.path <- \"J:/Work/Statistik/Kolb/Beratung/Gewichtung/pairfam/\"\nr.path <- paste(main.path,\"rcode/Gewichtung_neu/\",sep=\"\")\ndata.path <- \"S:/weighting\"\ndoku.path <- paste(main.path,\"Paper/\",sep=\"\")\ndata.path2 <- paste(main.path,\"data/\",sep=\"\")\n\n#-----------------------------------------------------#\n# Daten einlesen\n#-----------------------------------------------------#\n\nsetwd(data.path)\nload(\"neum.Rdata\")\n\n\n#-----------------------------------------------------#\n# In Faktoren umwandeln\n#-----------------------------------------------------#\n\ncol_names <- colnames(neum)\ncol_names <- col_names[-(1:2)]\n### man braucht kategoriale Variablen -> as.factor()\nneum[,col_names] <- lapply(neum[,col_names] , factor)\n\n#-----------------------------------------------------#\n## die drei Kohorten\n#-----------------------------------------------------#\n\ncoh1 <- subset(neum, neum$cohort==\"1 1991-1993\")\ncoh2 <- subset(neum, neum$cohort==\"2 1981-1983\")\ncoh3 <- subset(neum, neum$cohort==\"3 1971-1973\")\n\n\n### pcontact = NA -> aus dem Data Set entfernen\n## Kohorte 1\ncoh1a <- subset(coh1, !is.na(coh1$pcontact))\n\n## Kohorte 2\ncoh2a <- subset(coh2, !is.na(coh2$pcontact))\n\n## Kohorte 3\ncoh3a <- subset(coh3, !is.na(coh3$pcontact))\n\n## neum\nneuma <- subset(neum, !is.na(neum$pcontact))\n\n\n### panswer = NA -> aus dem Data Set entfernen\n## Kohorte 1\ncoh1b <- subset(coh1, !is.na(coh1$panswer))\n\n## Kohorte 2\ncoh2b <- subset(coh2, !is.na(coh2$panswer))\n\n## Kohorte 3\ncoh3b <- subset(coh3, !is.na(coh3$panswer))\n\n## neum\nneumb <- subset(neum, !is.na(neum$panswer))\n\n#-----------------------------------------------------#\n## Modelle\n#-----------------------------------------------------#\n\nDes <- c(\"ppanel Kohorte 1\",\"ppanel Kohorte 2\",\"ppanel Kohorte 3\",\"pcontact Kohorte 1\",\"pcontact Kohorte 2\",\n         \"pcontact Kohorte 3\",\"panswer Kohorte 1\",\"panswer Kohorte 2\",\"panswer Kohorte 3\")\n\n\nName <- c(\"ppanel1loglog\",\"ppanel2logit\",\"ppanel3logit\",\"pcontact1logit\",\"pcontact2probitint\",\n          \"pcontact3probit\",\"panswer1loglog\",\"panswer2loglogint\",\"panswer3loglog\")\nModi <- c(\"ppanel ~ lifesat + german + bik\",\n\"ppanel ~ sex1 + german + school1 + health + pincnet +bula + bik + ehestatus\",\n\"ppanel ~ german + school1 + health + pincnet + bula + bik\",\"pcontact ~ sex1 + school1 + house + hhsize1 + bula + \n                        bik + telcontact + perscontact\",\"pcontact ~ school1 + house + bula + bik + ehestatus +\n                            + telcontact + perscontact + house:bik + house:ehestatus\",\"pcontact ~ school1 + hhsize1 + house + bula + bik + \n                         telcontact + perscontact\",\"panswer ~ german + age + lifesat + bula + work + int1_2\",\n\"panswer ~ german + school1 + health + hhsize1 + pincnet + intinter + int1_2 + german:int1_2 + health:int1_2 + german:intinter\",\n\"panswer ~ german + school1 + lifesat + int1_2\")\nType <- c(\"family=binomial(link='cloglog')\",\"family=binomial\",\"binomial(link=logit)\",\n          \"family=binomial(link=logit)\",\"family=binomial(link=probit)\",\"family=binomial(link=probit)\",\n          \"family=binomial(link='cloglog')\",\"family=binomial(link=logit)\",\"family=binomial(link='cloglog')\")\nDat <- c(\"data=coh1\",\"data=coh2\",\"data=coh3\",\"data=coh1a\",\"data=coh2a\",\"data=coh3a\",\"data=coh1b\",\"data=coh2b\",\"data=coh3b\")\n\n# i <- 9\nfor (i in 1:length(Dat)){\n  eval(parse(text=paste(Name[i],\"<-glm(\",Modi[i],\",\",Type[i],\",\",Dat[i],\")\")))  \n  cat(i,\"\\n\")\n}\n\n\n#-----------------------------------------------------#\n## Vorhersage\n#-----------------------------------------------------#\n\ncoh1$ppanel1 <- predict(ppanel1loglog, type=\"response\")\ncoh2$ppanel1 <- predict(ppanel2logit, type=\"response\")\ncoh3$ppanel1 <- predict(ppanel3logit, type=\"response\")\n\ncoh1a$pcontact1 <- predict(pcontact1logit, type=\"response\")\ncoh2a$pcontact1 <- predict(pcontact2probitint, type=\"response\")\ncoh3a$pcontact1 <- predict(pcontact3probit, type=\"response\")\n\ncoh1b$panswer1 <- predict(panswer1loglog, type=\"response\")\ncoh2b$panswer1 <- predict(panswer2loglogint, type=\"response\")\ncoh3b$panswer1 <- predict(panswer3loglog, type=\"response\")\n\n#-----------------------------------------------------#\n### Erstellen der Gewichte ###\n#-----------------------------------------------------#\n\ndaten <- rbind(coh1b, coh2b, coh3b)\ndaten$gewichte <- 1/(daten$ppanel1 * daten$pcontact1 * daten$panswer1)\ndaten <- daten[order(daten$id), ]\n\n#-----------------------------------------------------#\n## Tabelle\n#-----------------------------------------------------#\n\n\nType2 <- as.character(Type)\nDes=as.character(Des)\n\nWK <- c(rep(\"Teilnahme\",3),rep(\"Antwort\",3),rep(\"Kontakt\",3))\n\nType2[Type2==\"family=binomial\"] <- \"logit\"\nType2[Type2==\"binomial(link=logit)\"] <- \"logit\"\n\n\nType2 <- sub(\"family=binomial\\\\(link=\",\"\",Type2)\nType2 <- sub(\"\\\\)\",\"\",Type2)\nType2 <- sub(\"\\\\'\",\"\",Type2)\n\nKoh <- paste(\"Kohorte\",rep(1:3,3))\nxTab1 <- data.frame(Koh,WK,Type2)\n\ncolnames(xTab1) <- c(\"Kohorte\",\"Wahrscheinlichkeit\",\"Link\")\n\nsetwd(data.path2)\nattr(xTab1,\"Info\") <- paste(author,scriptname,date())\nsave(xTab1,file=\"xTab1.Rdata\")\n\nxtable(xTab1)\n\n\n#-----------------------------------------------------#\n## Links\n#-----------------------------------------------------#\n\n  # how to replace parenthisis:\n# https://stat.ethz.ch/pipermail/r-help/2001-August/014356.html\n",
    "created" : 1435839858669.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "738492549",
    "id" : "7B961029",
    "lastKnownWriteTime" : 1435068283,
    "path" : "J:/Work/Statistik/Kolb/Beratung/Gewichtung/pairfam/rcode/Gewichtung_neu/weightsPairfam_A_1steps.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 18,
    "source_on_save" : false,
    "type" : "r_source"
}