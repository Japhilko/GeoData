{
    "contents" : "#---------------------------------------#\n# Survey Weighting with ALLBUS data\n# Jan-Philipp Kolb und Siegfried Gabler\n# Fri Jul 03 09:39:49 2015\n#---------------------------------------#\n# R version 3.1.2 (2014-10-31) -- \"Pumpkin Helmet\"\n# Platform: x86_64-w64-mingw32/x64 (64-bit)\n#---------------------------------------#\n# Generalities\n#---------------------------------------#\n\n\nrm(list=ls())\nauthor <- \"Siegfried Gabler, Jan-Philipp Kolb\"\nscriptname <- \"WeightALL_D_SurveyPackage.R\"\n\n#---------------------------------------#\n# libraries\n#---------------------------------------#\n\nlibrary(survey)\nlibrary(foreign)\n#---------------------------------------#\n# Paths\n#---------------------------------------#\n\npath <- \"J:/Work/Statistik/Kolb/Paper/Gewichtung/data\"\nr.path <- \"J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper\"\n\n\n#---------------------------------------#\n# Read data\n#---------------------------------------#\n\nsetwd(path)\nload(\"ALLBUSweights.RData\")\nx_ALL <- x\nload(\"ALLBUS10Vars.RData\")\n\n#---------------------------------------#\n# Read functions\n#---------------------------------------#\n\nsetwd(r.path)\nsource(\"WeightALL_B_functions.R\")\n\n#---------------------------------------#\n# Choose variables for analysis\n#---------------------------------------#\n\nDescr <- Vars[-c(1:3),3]\nVariablen <- as.character(Vars[-c(1:3),1])\n\nnVars <- c(\"p_inklusion\",\"gewfake\",\"pointint\",\"bikregbez\",\"bikbula\",\"regbez\",\"v942\",\"v762\",\"v977\",\"deutsch\",\"v976\")\nNind <- match(nVars,Variablen)\nVariablen <- Variablen[-Nind]\n\n\n\nErgList <-list()\n\n for(j in 1:length(Variablen)){\n\n  nr       <- match(Variablen[j],colnames(x))\n  x <- x_ALL\n  x        <- subset(x,is.na(x[,nr])==0)  # Zeilen mit missings in Variable werden gelÃ¶scht\n\n  #---------------------------------------#\n  # Compute mean etc for western Germany\n  #---------------------------------------#\n\n  # West\n  N_West    <- 8497      # Zahl der Gemeinden (PSUs); aus GEM2007.sav + Berlin-West\n  K_West    <- 55701259  # Zahl der 18+ Einwohner (SSUs); aus 6706109495_Allokationsprotokoll.txt\n  Mh_West   <- 111       # Zahl der Sample Points; aus 6706109495_Allokationsprotokoll.txt\n\n\n  x_West    <- subset(x,x$v5==1)\n  tab_lev <- table(x_West[,nr])\n\n  erg_West <- data.frame(Variable=Variablen[j],\n                         Level=names(tab_lev),\n                         Estimator.mean=NA,\n                         Variance.estimator=NA,\n                         Estimator.for.sigma.2=NA,\n                         Sampling.variance=NA,\n                         mean_survey=NA,\n                         variance_survey=NA,\n                         DEff_survey=NA\n  )\n\n ID <- 1:nrow(x_West)\n tab_v762 <- table(x_West$v762)\n  x_West$prob1 <- (x_West$Mi/K_West)*length(tab_v762)\n ind <- match(x_West$v762,names(tab_v762))\n x_West$prob2 <- tab_v762[ind]/x_West$Mi\n\n  write.dta(x_West,file=paste())\n  for (i in 1:length(tab_lev)){\n    ys_West   <- as.numeric(x_West[,nr]==names(tab_lev)[i])\n    n_West   <- nrow(x_West)\n\n    dclus_ALLB <-svydesign(id=~v762+ID,prob=~prob1+prob2,data=x_West)\n\n    erg_West[i,3:6] <-  sig_hat(ys=ys_West,\n                               Mi=x_West$Mi,\n                               PSU=x_West$PSU,\n                               sPSU=x_West$v762,\n                               N=N_West,\n                               K=K_West)\n    erg_survey <- svymean(~ys_West, dclus_ALLB, deff=TRUE)\n    erg_West[i,\"mean_survey\"] <- erg_survey\n    erg_West[i,\"variance_survey\"] <- SE(erg_survey)^2\n    erg_West[i,\"DEff_survey\"] <- deff(erg_survey)\n  }\n\n\n  ErgList[[j]] <-  erg_West\n }\n\nErg_df <- do.call(rbind,ErgList)\n\n\n# Estimator for Deff\nErg_df$Deff <- with(Erg_df,Variance.estimator/Estimator.for.sigma.2*n_West)\n\n# Estimator for Deff(s^2)\n\nErg_df$Deff_s2 <- with(Erg_df,Variance.estimator/Sampling.variance*n_West)\n\n#---------------------------------------#\n# Save the results\n#---------------------------------------#\n\nsetwd(path)\nsave(Erg_df,file=\"ALLBUS10_Erg_df.RData\")\n\n#---------------------------------------#\n# Analysis\n#---------------------------------------#\n\n\n\nsum(weights(dclus_ALLB))\n\n# with(x_West,tapply(Mi,v762,unique))\n\n# with(x_West,tapply(Mi,v762,function(x)length(unique(x))))\n\n\n",
    "created" : 1436180391992.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3760564883",
    "id" : "9787289",
    "lastKnownWriteTime" : 1436182908,
    "path" : "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper/WeightALL_D_SurveyPackage.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "type" : "r_source"
}