{
    "contents" : "# Mon Jun 29 10:46:17 2015\n# functions\n\nblock_vd2 <- function(y,PSU){\n  d=0\n  for(i in 1:length(PSU)){\n    ym1 <- y[i]\n    ym2 <- y[PSU!=PSU[i]]\n    d   <- d+sum(outer(ym1,ym2,\"-\")^2)\n  }\n  return(d)\n}\n\nblock_mean <- function(y,SP){aggregate(y,by=list(SP),FUN=\"mean\")}\n\n# block_sih(y,PSU): Varianzen der y-Werte in den SamplePoints\n# block_sih <- function(y,SP){aggregate(y,by=list(SP),FUN=\"var\")  }\n# block_sih <- function(y,SP){tapply(y,SP,var,na.rm=T)}\n\nblock_sih <- function(y,SP){\n  tabSP <- table(SP)\n  ind <- names(tabSP)[which(tabSP==1)]\n  erg <- aggregate(y,by=list(SP),FUN=\"var\")\n  erg[ind,] <- 0\n  return(erg)\n}\n\n\nsig_hat <- function(ys,Mi,PSU,sPSU,N,K){\n  UsPSU  <- unique(sPSU)\n  Mhs  <- Mi[match(UsPSU,sPSU)]\n  s_PSU     <- PSU[match(UsPSU,sPSU)]\n\n  ss_list   <- list()\n\n  UsPSU  <- unique(sPSU)\n  for(i in 1:length(UsPSU)){\n    ss_list[[i]] <- which(sPSU%in%UsPSU[i])\n  }\n\n  n     <- length(ss_list)  # Zahl der ausgewählten PSUs\n\n  mhs      <- rep(0,n)         # Stichprobenumfänge in den ausgewählten PSUs\n  for(i in 1:n){ mhs[i] <- length(ss_list[[i]]) }\n\n  w        <- prod(Mhs/K)/prod(choose(Mhs,mhs)) # Gewicht für Stichproben\n  S2       <- var(ys)\n\n  PSU_v    <- rep(0, length(ys))  # geändert 11.12.2014\n  for(i in 1:n){  PSU_v[ss_list[[i]]] <- i } # Neunummerierung von 1,...,n\n\n  ybar_i  <- block_mean(ys,PSU_v)[,2]\n  sih2    <- block_sih(ys,PSU_v)[,2]\n\n  Hi      <- table(s_PSU)\n  Hi      <- Hi[as.character(s_PSU)]  # Hi gibt für jede ausgewählte PSU die Häufigkeit an, mit der sie in der Stichprobe vorkommt\n  e       <- sum(ybar_i)/n   # Schätzer für ty/K\n  v1      <- 1/(n*K)*sum( (Mhs-1)*sih2 )\n  v2      <- sum( (n-Hi)*( (mhs-1)/mhs*sih2) )/(n*(n-1))\n  v3      <- block_vd2(ybar_i,s_PSU)/(2*n*(n-1))\n  sig2_hat <- v1+v2+v3 # Schätzer für sigma^2\n  v_hat   <- sum( (ybar_i - sum(ybar_i)/n)^2 )/(n*(n-1))  # Varianzschätzung des Schätzers für Y_bar\n\n  Res <- c(e,v_hat,sig2_hat,S2)\n  names(Res) <- c(\"Estimator mean\",\"Variance estimator\",\"Estimator for sigma^2\",\"Sampling variance\")\n  return(Res)\n}\n\n",
    "created" : 1435906148589.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2547930207",
    "id" : "4B733C5F",
    "lastKnownWriteTime" : 1435906365,
    "path" : "J:/Work/Statistik/Kolb/Paper/Gewichtung/Rcode/rcodePaper/WeightALL_B_functions.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}